<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STEP ëŒ€ìˆ˜ â€” ì§€ìˆ˜í•¨ìˆ˜ì™€ ë¡œê·¸í•¨ìˆ˜</title>

<!-- MathJax -->
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true
  },
  options: { skipHtmlTags: ['script','noscript','style','textarea','pre'] }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STEP ëŒ€ìˆ˜ â€” Design System
   Aesthetic: ì •ë°€í•œ ë‹¤í¬ ì•„ì¹´ë°ë¯¸ì•„ + ê³µí•™ì  ê·¸ë¦¬ë“œ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&family=JetBrains+Mono:wght@400;600&family=Playfair+Display:wght@700&display=swap');

:root {
  --bg-0: #0d0f14;
  --bg-1: #13161e;
  --bg-2: #1b1f2b;
  --bg-3: #232838;
  --bg-4: #2c3145;

  --red:    #e84545;
  --red-dim: #c03535;
  --red-glow: rgba(232, 69, 69, 0.18);
  --gold:   #d4a843;
  --green:  #4caf7d;
  --blue:   #5b9cf6;
  --purple: #9b7fe8;

  --txt-0: #f0f2f7;
  --txt-1: #b8bdd0;
  --txt-2: #7a819a;
  --txt-3: #4a5068;

  --border: rgba(255,255,255,0.07);
  --border-active: rgba(232,69,69,0.45);

  --radius: 10px;
  --radius-sm: 6px;
  --shadow: 0 4px 24px rgba(0,0,0,0.45);
  --shadow-sm: 0 2px 10px rgba(0,0,0,0.3);

  --sidebar-w: 260px;
  --font-sans: 'Noto Sans KR', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --font-disp: 'Playfair Display', serif;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { font-size: 15px; scroll-behavior: smooth; }

body {
  font-family: var(--font-sans);
  background: var(--bg-0);
  color: var(--txt-0);
  min-height: 100vh;
  display: flex;
  overflow-x: hidden;
}

/* â”€â”€ Scrollbar â”€â”€ */
::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: var(--bg-1); }
::-webkit-scrollbar-thumb { background: var(--bg-4); border-radius: 3px; }
::-webkit-scrollbar-thumb:hover { background: var(--txt-3); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar {
  width: var(--sidebar-w);
  min-height: 100vh;
  background: var(--bg-1);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  position: fixed;
  left: 0; top: 0; bottom: 0;
  z-index: 100;
  overflow-y: auto;
}

.sidebar-logo {
  padding: 24px 20px 18px;
  border-bottom: 1px solid var(--border);
}
.logo-step {
  font-family: var(--font-disp);
  font-size: 22px;
  color: var(--red);
  letter-spacing: 0.04em;
  line-height: 1;
}
.logo-sub {
  font-size: 11px;
  color: var(--txt-2);
  margin-top: 4px;
  font-family: var(--font-mono);
  letter-spacing: 0.08em;
}

/* Mode Toggle */
.mode-toggle {
  display: flex;
  margin: 14px 16px;
  background: var(--bg-2);
  border-radius: var(--radius-sm);
  padding: 3px;
  gap: 3px;
}
.mode-btn {
  flex: 1;
  padding: 7px;
  border: none;
  border-radius: 4px;
  background: transparent;
  color: var(--txt-2);
  font-size: 12px;
  font-family: var(--font-sans);
  cursor: pointer;
  transition: all 0.2s;
}
.mode-btn.active {
  background: var(--bg-4);
  color: var(--txt-0);
}

/* Nav Section */
.nav-section {
  padding: 8px 0;
}
.nav-label {
  padding: 6px 20px 4px;
  font-size: 10px;
  color: var(--txt-3);
  letter-spacing: 0.12em;
  text-transform: uppercase;
  font-family: var(--font-mono);
}
.nav-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 9px 20px;
  cursor: pointer;
  transition: all 0.18s;
  border-left: 2px solid transparent;
  color: var(--txt-2);
  font-size: 13.5px;
}
.nav-item:hover { background: var(--bg-2); color: var(--txt-1); }
.nav-item.active {
  background: var(--red-glow);
  border-left-color: var(--red);
  color: var(--txt-0);
}
.nav-item .theme-badge {
  font-family: var(--font-mono);
  font-size: 10px;
  padding: 2px 6px;
  border-radius: 4px;
  background: var(--bg-3);
  margin-left: auto;
  color: var(--txt-3);
}
.nav-item.active .theme-badge {
  background: var(--red-dim);
  color: #fff;
}

.sidebar-progress {
  margin: 12px 16px;
  padding: 14px 16px;
  background: var(--bg-2);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
}
.progress-title {
  font-size: 11px;
  color: var(--txt-2);
  margin-bottom: 10px;
  font-family: var(--font-mono);
  letter-spacing: 0.06em;
}
.progress-stat {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 7px;
}
.progress-stat-label { font-size: 12px; color: var(--txt-1); }
.progress-stat-val {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--green);
}
.progress-bar-wrap {
  height: 4px;
  background: var(--bg-3);
  border-radius: 2px;
  overflow: hidden;
  margin-top: 4px;
}
.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--red), var(--gold));
  border-radius: 2px;
  transition: width 0.5s ease;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN CONTENT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main {
  margin-left: var(--sidebar-w);
  flex: 1;
  display: flex;
  flex-direction: column;
  min-height: 100vh;
}

/* Topbar */
.topbar {
  height: 58px;
  background: var(--bg-1);
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  padding: 0 28px;
  gap: 16px;
  position: sticky;
  top: 0;
  z-index: 50;
}
.topbar-title {
  font-size: 16px;
  font-weight: 500;
  color: var(--txt-0);
  flex: 1;
}
.topbar-filters {
  display: flex;
  gap: 8px;
}
.filter-pill {
  padding: 5px 12px;
  border-radius: 20px;
  border: 1px solid var(--border);
  background: var(--bg-2);
  color: var(--txt-2);
  font-size: 12px;
  cursor: pointer;
  transition: all 0.18s;
  font-family: var(--font-sans);
}
.filter-pill:hover { border-color: var(--txt-3); color: var(--txt-1); }
.filter-pill.active {
  border-color: var(--red);
  background: var(--red-glow);
  color: var(--txt-0);
}
.topbar-search {
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  padding: 6px 12px 6px 32px;
  color: var(--txt-0);
  font-size: 13px;
  font-family: var(--font-sans);
  width: 180px;
  outline: none;
  transition: border-color 0.2s;
  position: relative;
}
.topbar-search:focus { border-color: var(--red); }
.search-wrap { position: relative; }
.search-icon {
  position: absolute;
  left: 10px; top: 50%;
  transform: translateY(-50%);
  color: var(--txt-3);
  font-size: 13px;
  pointer-events: none;
}

/* Content area */
.content {
  padding: 28px;
  flex: 1;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.view { display: none; }
.view.active { display: block; }

/* â”€â”€ Dashboard â”€â”€ */
.dashboard-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 16px;
  margin-bottom: 28px;
}
.stat-card {
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  position: relative;
  overflow: hidden;
}
.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
}
.stat-card.red::before { background: var(--red); }
.stat-card.gold::before { background: var(--gold); }
.stat-card.green::before { background: var(--green); }
.stat-card.blue::before { background: var(--blue); }

.stat-val {
  font-family: var(--font-disp);
  font-size: 36px;
  color: var(--txt-0);
  line-height: 1;
}
.stat-label {
  font-size: 12px;
  color: var(--txt-2);
  margin-top: 6px;
  font-family: var(--font-mono);
}

.section-heading {
  font-size: 14px;
  color: var(--txt-2);
  font-family: var(--font-mono);
  letter-spacing: 0.08em;
  text-transform: uppercase;
  margin-bottom: 14px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}

/* Theme progress cards */
.theme-cards {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 14px;
  margin-bottom: 28px;
}
.theme-card {
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 18px;
  cursor: pointer;
  transition: all 0.2s;
}
.theme-card:hover {
  border-color: var(--border-active);
  background: var(--bg-3);
  transform: translateY(-2px);
  box-shadow: var(--shadow-sm);
}
.theme-card-label {
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--red);
  letter-spacing: 0.1em;
  margin-bottom: 6px;
}
.theme-card-title { font-size: 14px; font-weight: 500; margin-bottom: 12px; }
.theme-mini-bar {
  display: flex;
  gap: 3px;
  margin-bottom: 8px;
}
.theme-mini-dot {
  width: 14px; height: 14px;
  border-radius: 3px;
  background: var(--bg-4);
  transition: background 0.2s;
}
.theme-mini-dot.solved { background: var(--green); }
.theme-mini-dot.attempted { background: var(--gold); }
.theme-count {
  font-size: 12px;
  color: var(--txt-2);
  font-family: var(--font-mono);
}

/* â”€â”€ Problem List â”€â”€ */
.problem-grid {
  display: grid;
  gap: 10px;
}
.problem-card {
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px 20px;
  display: grid;
  grid-template-columns: auto 1fr auto auto;
  align-items: center;
  gap: 16px;
  cursor: pointer;
  transition: all 0.18s;
}
.problem-card:hover {
  border-color: rgba(255,255,255,0.14);
  background: var(--bg-3);
}
.problem-card.solved { border-left: 3px solid var(--green); }
.problem-card.attempted { border-left: 3px solid var(--gold); }

.prob-id {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--txt-3);
  width: 60px;
}
.prob-question {
  font-size: 13.5px;
  color: var(--txt-1);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.level-badge {
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 11px;
  font-family: var(--font-mono);
  white-space: nowrap;
}
.level-badge.ê¸°ë³¸ { background: rgba(91,156,246,0.15); color: var(--blue); }
.level-badge.ì‹¬í™” { background: rgba(212,168,67,0.15); color: var(--gold); }
.level-badge.STEPUP, .level-badge[data-level="STEP UP"] {
  background: rgba(232,69,69,0.15); color: var(--red);
}
.type-badge {
  font-size: 11px;
  color: var(--txt-3);
  font-family: var(--font-mono);
}

/* â”€â”€ Problem Solve View â”€â”€ */
.problem-solve-wrap {
  max-width: 780px;
  margin: 0 auto;
}
.prob-nav-bar {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 24px;
}
.back-btn {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--txt-1);
  font-size: 13px;
  cursor: pointer;
  transition: all 0.18s;
  font-family: var(--font-sans);
}
.back-btn:hover { border-color: var(--txt-3); color: var(--txt-0); }

.prob-meta-bar {
  display: flex;
  gap: 8px;
  align-items: center;
  flex: 1;
}

.problem-box {
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 20px;
}
.problem-box-header {
  background: var(--bg-3);
  padding: 14px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  border-bottom: 1px solid var(--border);
}
.problem-box-title {
  font-family: var(--font-mono);
  font-size: 12px;
  color: var(--red);
  letter-spacing: 0.08em;
}
.problem-box-body {
  padding: 24px;
  font-size: 16px;
  line-height: 1.85;
  color: var(--txt-0);
}
.problem-box-body .prob-emph { font-weight: 700; }

/* Choices */
.choices-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-top: 20px;
}
@media (max-width: 560px) { .choices-grid { grid-template-columns: 1fr; } }

.choice-item {
  padding: 12px 16px;
  background: var(--bg-3);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.18s;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 14px;
}
.choice-item:hover { border-color: var(--txt-3); background: var(--bg-4); }
.choice-item.selected { border-color: var(--blue); background: rgba(91,156,246,0.1); }
.choice-item.correct { border-color: var(--green); background: rgba(76,175,125,0.12); }
.choice-item.wrong { border-color: var(--red); background: rgba(232,69,69,0.1); }
.choice-num {
  width: 24px; height: 24px;
  border-radius: 50%;
  background: var(--bg-4);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px;
  font-family: var(--font-mono);
  flex-shrink: 0;
}
.choice-item.selected .choice-num { background: var(--blue); color: #fff; }
.choice-item.correct .choice-num { background: var(--green); color: #fff; }
.choice-item.wrong .choice-num { background: var(--red); color: #fff; }

/* Short answer */
.answer-input-wrap {
  margin-top: 20px;
  display: flex;
  gap: 10px;
  align-items: center;
}
.answer-input {
  flex: 1;
  max-width: 240px;
  padding: 11px 16px;
  background: var(--bg-3);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--txt-0);
  font-size: 16px;
  font-family: var(--font-mono);
  outline: none;
  transition: border-color 0.2s;
}
.answer-input:focus { border-color: var(--blue); }
.answer-input.correct { border-color: var(--green); }
.answer-input.wrong { border-color: var(--red); }

/* Action buttons */
.btn {
  padding: 10px 20px;
  border-radius: var(--radius-sm);
  border: none;
  font-size: 14px;
  font-family: var(--font-sans);
  cursor: pointer;
  transition: all 0.18s;
  font-weight: 500;
}
.btn-primary {
  background: var(--red);
  color: #fff;
}
.btn-primary:hover { background: var(--red-dim); }
.btn-primary:disabled { opacity: 0.4; cursor: not-allowed; }
.btn-outline {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--txt-1);
}
.btn-outline:hover { border-color: var(--txt-3); color: var(--txt-0); }
.btn-ghost {
  background: transparent;
  color: var(--txt-2);
  padding: 8px 12px;
  font-size: 13px;
}
.btn-ghost:hover { color: var(--txt-0); }

/* Result feedback */
.result-banner {
  padding: 14px 18px;
  border-radius: var(--radius-sm);
  margin-top: 16px;
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 14px;
  display: none;
}
.result-banner.correct-banner {
  background: rgba(76,175,125,0.12);
  border: 1px solid rgba(76,175,125,0.3);
  color: var(--green);
}
.result-banner.wrong-banner {
  background: rgba(232,69,69,0.1);
  border: 1px solid rgba(232,69,69,0.25);
  color: #f88;
}
.result-banner.show { display: flex; }

/* Hint & Solution boxes */
.accordion-box {
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  margin-bottom: 12px;
}
.accordion-header {
  padding: 13px 20px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  cursor: pointer;
  transition: background 0.18s;
  user-select: none;
}
.accordion-header:hover { background: var(--bg-3); }
.accordion-header-left {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 13.5px;
  color: var(--txt-1);
}
.accordion-icon {
  width: 28px; height: 28px;
  border-radius: 6px;
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
}
.accordion-icon.hint { background: rgba(212,168,67,0.15); color: var(--gold); }
.accordion-icon.solution { background: rgba(76,175,125,0.15); color: var(--green); }
.accordion-chevron {
  color: var(--txt-3);
  font-size: 12px;
  transition: transform 0.2s;
}
.accordion-chevron.open { transform: rotate(180deg); }
.accordion-body {
  padding: 0 20px;
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease, padding 0.3s;
}
.accordion-body.open {
  padding: 16px 20px 20px;
  max-height: 1200px;
}
.accordion-body-inner {
  font-size: 14.5px;
  line-height: 1.9;
  color: var(--txt-1);
  border-top: 1px solid var(--border);
  padding-top: 16px;
}

/* Problem navigation bottom */
.prob-nav-bottom {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 24px;
  padding-top: 20px;
  border-top: 1px solid var(--border);
}
.prob-actions { display: flex; gap: 10px; }

/* â”€â”€ Teacher Dashboard â”€â”€ */
.teacher-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}
@media (max-width: 900px) { .teacher-grid { grid-template-columns: 1fr; } }

.panel {
  background: var(--bg-2);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
}
.panel-header {
  padding: 14px 18px;
  background: var(--bg-3);
  border-bottom: 1px solid var(--border);
  font-size: 13px;
  font-family: var(--font-mono);
  color: var(--txt-1);
  letter-spacing: 0.06em;
  display: flex;
  align-items: center;
  gap: 8px;
}
.panel-body { padding: 16px 18px; }

/* Student list */
.student-row {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 9px 0;
  border-bottom: 1px solid var(--border);
}
.student-row:last-child { border-bottom: none; }
.student-avatar {
  width: 32px; height: 32px;
  border-radius: 50%;
  background: var(--bg-4);
  display: flex; align-items: center; justify-content: center;
  font-size: 12px;
  font-weight: 600;
  color: var(--txt-1);
  flex-shrink: 0;
}
.student-name { font-size: 13px; flex: 1; }
.student-progress {
  font-family: var(--font-mono);
  font-size: 11px;
  color: var(--txt-2);
}
.mini-prog {
  width: 80px;
  height: 4px;
  background: var(--bg-4);
  border-radius: 2px;
  overflow: hidden;
}
.mini-prog-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--red), var(--gold));
  border-radius: 2px;
}

/* Error rate table */
.error-table { width: 100%; border-collapse: collapse; }
.error-table th {
  font-size: 11px;
  font-family: var(--font-mono);
  color: var(--txt-3);
  text-align: left;
  padding: 6px 8px;
  border-bottom: 1px solid var(--border);
}
.error-table td {
  font-size: 12.5px;
  padding: 9px 8px;
  border-bottom: 1px solid rgba(255,255,255,0.04);
  color: var(--txt-1);
}
.error-rate {
  font-family: var(--font-mono);
  font-size: 12px;
}
.error-rate.high { color: var(--red); }
.error-rate.mid { color: var(--gold); }
.error-rate.low { color: var(--green); }
.error-bar-sm {
  width: 60px; height: 4px;
  background: var(--bg-4);
  border-radius: 2px;
  overflow: hidden;
  display: inline-block;
  vertical-align: middle;
  margin-right: 6px;
}
.error-bar-fill {
  height: 100%;
  border-radius: 2px;
}

/* â”€â”€ Notification Toast â”€â”€ */
.toast {
  position: fixed;
  bottom: 28px; right: 28px;
  background: var(--bg-3);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px 20px;
  font-size: 13.5px;
  color: var(--txt-0);
  box-shadow: var(--shadow);
  z-index: 9999;
  transform: translateY(80px);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
  display: flex;
  align-items: center;
  gap: 10px;
}
.toast.show { transform: translateY(0); opacity: 1; }
.toast.success { border-color: rgba(76,175,125,0.4); }
.toast.error { border-color: rgba(232,69,69,0.4); }

/* Empty state */
.empty-state {
  text-align: center;
  padding: 60px 20px;
  color: var(--txt-3);
}
.empty-icon { font-size: 40px; margin-bottom: 12px; }
.empty-text { font-size: 14px; }

/* Highlight on correct answer reveal */
.answer-reveal {
  display: inline-block;
  padding: 4px 12px;
  background: rgba(76,175,125,0.15);
  border: 1px solid rgba(76,175,125,0.3);
  border-radius: var(--radius-sm);
  font-family: var(--font-mono);
  color: var(--green);
  font-size: 15px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH â€” ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.auth-overlay {
  position: fixed;
  inset: 0;
  background: var(--bg-0);
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 20px;
}
.auth-box {
  width: 100%;
  max-width: 400px;
  background: var(--bg-1);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 40px 36px;
  box-shadow: 0 24px 60px rgba(0,0,0,0.6);
}
.auth-logo {
  text-align: center;
  margin-bottom: 32px;
}
.auth-logo-text {
  font-family: var(--font-disp);
  font-size: 32px;
  color: var(--red);
}
.auth-logo-sub {
  font-size: 12px;
  color: var(--txt-2);
  font-family: var(--font-mono);
  margin-top: 6px;
  letter-spacing: 0.08em;
}
.auth-tabs {
  display: flex;
  background: var(--bg-2);
  border-radius: var(--radius-sm);
  padding: 3px;
  gap: 3px;
  margin-bottom: 28px;
}
.auth-tab {
  flex: 1;
  padding: 8px;
  border: none;
  border-radius: 4px;
  background: transparent;
  color: var(--txt-2);
  font-size: 13px;
  font-family: var(--font-sans);
  cursor: pointer;
  transition: all 0.2s;
}
.auth-tab.active {
  background: var(--bg-4);
  color: var(--txt-0);
}
.auth-field {
  margin-bottom: 16px;
}
.auth-label {
  display: block;
  font-size: 12px;
  color: var(--txt-2);
  margin-bottom: 6px;
  font-family: var(--font-mono);
  letter-spacing: 0.06em;
}
.auth-input {
  width: 100%;
  padding: 11px 14px;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--txt-0);
  font-size: 14px;
  font-family: var(--font-sans);
  outline: none;
  transition: border-color 0.2s;
}
.auth-input:focus { border-color: var(--red); }
.auth-role-group {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
.auth-role-btn {
  flex: 1;
  padding: 10px;
  background: var(--bg-2);
  border: 1.5px solid var(--border);
  border-radius: var(--radius-sm);
  color: var(--txt-2);
  font-size: 13px;
  font-family: var(--font-sans);
  cursor: pointer;
  transition: all 0.18s;
  text-align: center;
}
.auth-role-btn.selected {
  border-color: var(--red);
  background: var(--red-glow);
  color: var(--txt-0);
}
.auth-submit {
  width: 100%;
  padding: 13px;
  background: var(--red);
  border: none;
  border-radius: var(--radius-sm);
  color: #fff;
  font-size: 15px;
  font-family: var(--font-sans);
  font-weight: 600;
  cursor: pointer;
  transition: background 0.18s;
  margin-top: 8px;
}
.auth-submit:hover { background: var(--red-dim); }
.auth-submit:disabled { opacity: 0.5; cursor: not-allowed; }
.auth-error {
  margin-top: 12px;
  padding: 10px 14px;
  background: rgba(232,69,69,0.1);
  border: 1px solid rgba(232,69,69,0.3);
  border-radius: var(--radius-sm);
  color: #f88;
  font-size: 13px;
  display: none;
}
.auth-error.show { display: block; }

/* ì‚¬ì´ë“œë°” ìœ ì € ì •ë³´ */
.sidebar-user {
  margin: 12px 16px;
  padding: 12px 14px;
  background: var(--bg-2);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border);
  display: flex;
  align-items: center;
  gap: 10px;
}
.user-avatar {
  width: 34px; height: 34px;
  border-radius: 50%;
  background: var(--red-glow);
  border: 1.5px solid var(--red-dim);
  display: flex; align-items: center; justify-content: center;
  font-size: 14px;
  flex-shrink: 0;
  color: var(--red);
  font-weight: 700;
}
.user-info { flex: 1; overflow: hidden; }
.user-name {
  font-size: 13px;
  font-weight: 500;
  color: var(--txt-0);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.user-role {
  font-size: 10px;
  color: var(--txt-3);
  font-family: var(--font-mono);
  margin-top: 2px;
}
.logout-btn {
  background: none;
  border: none;
  color: var(--txt-3);
  cursor: pointer;
  font-size: 16px;
  padding: 4px;
  transition: color 0.18s;
  flex-shrink: 0;
}
.logout-btn:hover { color: var(--red); }
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  AUTH OVERLAY â€” ë¡œê·¸ì¸/íšŒì›ê°€ì…
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="auth-overlay" id="auth-overlay">
  <div class="auth-box">
    <div class="auth-logo">
      <div class="auth-logo-text">STEP ëŒ€ìˆ˜</div>
      <div class="auth-logo-sub">ì§€ìˆ˜í•¨ìˆ˜ì™€ ë¡œê·¸í•¨ìˆ˜ Â· ë§ì¶¤í˜• í•™ìŠµ í”Œë«í¼</div>
    </div>

    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchAuthTab('login')">ë¡œê·¸ì¸</button>
      <button class="auth-tab" onclick="switchAuthTab('signup')">íšŒì›ê°€ì…</button>
    </div>

    <!-- ë¡œê·¸ì¸ í¼ -->
    <div id="auth-login-form">
      <div class="auth-field">
        <label class="auth-label">ì´ë©”ì¼</label>
        <input class="auth-input" type="email" id="login-email" placeholder="example@email.com">
      </div>
      <div class="auth-field">
        <label class="auth-label">ë¹„ë°€ë²ˆí˜¸</label>
        <input class="auth-input" type="password" id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"
          onkeydown="if(event.key==='Enter')handleLogin()">
      </div>
      <button class="auth-submit" id="login-btn" onclick="handleLogin()">ë¡œê·¸ì¸</button>
      <div class="auth-error" id="login-error"></div>
    </div>

    <!-- íšŒì›ê°€ì… í¼ -->
    <div id="auth-signup-form" style="display:none;">
      <div class="auth-field">
        <label class="auth-label">ì´ë¦„</label>
        <input class="auth-input" type="text" id="signup-name" placeholder="í™ê¸¸ë™">
      </div>
      <div class="auth-field">
        <label class="auth-label">ì´ë©”ì¼</label>
        <input class="auth-input" type="email" id="signup-email" placeholder="example@email.com">
      </div>
      <div class="auth-field">
        <label class="auth-label">ë¹„ë°€ë²ˆí˜¸ (6ì ì´ìƒ)</label>
        <input class="auth-input" type="password" id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì„¤ì •">
      </div>
      <div class="auth-field">
        <label class="auth-label">ì—­í• </label>
        <div class="auth-role-group">
          <button class="auth-role-btn selected" id="role-student" onclick="selectRole('student')">ğŸ“ í•™ìƒ</button>
          <button class="auth-role-btn" id="role-teacher" onclick="selectRole('teacher')">ğŸ‘¨â€ğŸ« ì„ ìƒë‹˜</button>
        </div>
      </div>
      <button class="auth-submit" id="signup-btn" onclick="handleSignup()">íšŒì›ê°€ì…</button>
      <div class="auth-error" id="signup-error"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-step">STEP ëŒ€ìˆ˜</div>
    <div class="logo-sub">ì§€ìˆ˜í•¨ìˆ˜ì™€ ë¡œê·¸í•¨ìˆ˜ Â· Ch.1</div>
  </div>

  <div class="mode-toggle" id="mode-toggle-wrap">
    <button class="mode-btn active" onclick="setMode('student')">í•™ìƒ</button>
    <button class="mode-btn" onclick="setMode('teacher')">ì„ ìƒë‹˜</button>
  </div>

  <!-- ë¡œê·¸ì¸ ìœ ì € ì •ë³´ -->
  <div class="sidebar-user" id="sidebar-user" style="display:none;">
    <div class="user-avatar" id="user-avatar">?</div>
    <div class="user-info">
      <div class="user-name" id="user-name">â€”</div>
      <div class="user-role" id="user-role-label">student</div>
    </div>
    <button class="logout-btn" onclick="handleLogout()" title="ë¡œê·¸ì•„ì›ƒ">â»</button>
  </div>

  <nav class="nav-section">
    <div class="nav-label">ë©”ë‰´</div>
    <div class="nav-item active" onclick="showView('dashboard')" id="nav-dashboard">
      <span>ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ
    </div>
    <div class="nav-item" onclick="showView('problems')" id="nav-problems">
      <span>ğŸ“</span> ë¬¸ì œ ëª©ë¡ <span class="theme-badge">37</span>
    </div>
  </nav>

  <nav class="nav-section">
    <div class="nav-label">Chapter 1 â€” ë‹¨ì›</div>
    <div class="nav-item" onclick="filterAndShow('T1')" id="nav-T1">
      <span>â‘ </span> ê±°ë“­ì œê³±ê·¼ <span class="theme-badge">4</span>
    </div>
    <div class="nav-item" onclick="filterAndShow('T2')" id="nav-T2">
      <span>â‘¡</span> ì§€ìˆ˜ë²•ì¹™ <span class="theme-badge">8</span>
    </div>
    <div class="nav-item" onclick="filterAndShow('T3')" id="nav-T3">
      <span>â‘¢</span> ë¡œê·¸ì˜ ì„±ì§ˆ <span class="theme-badge">9</span>
    </div>
    <div class="nav-item" onclick="filterAndShow('T4')" id="nav-T4">
      <span>â‘£</span> ìƒìš©ë¡œê·¸ <span class="theme-badge">3</span>
    </div>
    <div class="nav-item" onclick="filterAndShow('STEPUP')" id="nav-STEPUP">
      <span>â­</span> STEP UP <span class="theme-badge">13</span>
    </div>
  </nav>

  <div class="sidebar-progress" id="sidebar-progress-wrap">
    <div class="progress-title">MY PROGRESS</div>
    <div class="progress-stat">
      <span class="progress-stat-label">í’€ì´ ì™„ë£Œ</span>
      <span class="progress-stat-val" id="prog-solved">0 / 37</span>
    </div>
    <div class="progress-bar-wrap">
      <div class="progress-bar-fill" id="prog-bar" style="width:0%"></div>
    </div>
  </div>
</aside>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  MAIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main class="main">
  <div class="topbar">
    <div class="topbar-title" id="topbar-title">ëŒ€ì‹œë³´ë“œ</div>
    <div class="topbar-filters" id="topbar-filters">
      <button class="filter-pill active" onclick="setLevelFilter('all')">ì „ì²´</button>
      <button class="filter-pill" onclick="setLevelFilter('ê¸°ë³¸')">ê¸°ë³¸</button>
      <button class="filter-pill" onclick="setLevelFilter('ì‹¬í™”')">ì‹¬í™”</button>
      <button class="filter-pill" onclick="setLevelFilter('STEP UP')">STEP UP</button>
    </div>
    <div class="search-wrap">
      <span class="search-icon">ğŸ”</span>
      <input class="topbar-search" type="text" placeholder="ë¬¸ì œ ê²€ìƒ‰..." id="search-input" oninput="onSearch()">
    </div>
  </div>

  <div class="content">

    <!-- â”€â”€ VIEW: DASHBOARD â”€â”€ -->
    <div class="view active" id="view-dashboard">
      <div class="dashboard-grid">
        <div class="stat-card red">
          <div class="stat-val">37</div>
          <div class="stat-label">TOTAL PROBLEMS</div>
        </div>
        <div class="stat-card gold">
          <div class="stat-val" id="stat-solved">0</div>
          <div class="stat-label">SOLVED</div>
        </div>
        <div class="stat-card green">
          <div class="stat-val" id="stat-accuracy">â€”</div>
          <div class="stat-label">ACCURACY</div>
        </div>
        <div class="stat-card blue">
          <div class="stat-val" id="stat-streak">0</div>
          <div class="stat-label">STREAK</div>
        </div>
      </div>

      <div class="section-heading" id="dash-section-heading">CHAPTER 1 Â· ë‹¨ì›ë³„ í˜„í™©</div>

      <!-- Student: theme cards -->
      <div class="theme-cards" id="student-theme-cards">
        <!-- rendered by JS -->
      </div>

      <!-- Teacher dashboard -->
      <div id="teacher-dash" style="display:none;">

        <!-- ìš”ì•½ ì¹´ë“œ 3ê°œ -->
        <div class="stats-grid" style="margin-bottom:20px;">
          <div class="stat-card">
            <div class="stat-val" id="stat-total-students">â€”</div>
            <div class="stat-label">STUDENTS</div>
          </div>
          <div class="stat-card gold">
            <div class="stat-val" id="stat-total-subs">â€”</div>
            <div class="stat-label">TOTAL SUBMISSIONS</div>
          </div>
          <div class="stat-card green">
            <div class="stat-val" id="stat-active-today">â€”</div>
            <div class="stat-label">ACTIVE TODAY</div>
          </div>
          <div class="stat-card blue" style="cursor:pointer;" onclick="renderTeacherDash()">
            <div class="stat-val">â†»</div>
            <div class="stat-label">ìƒˆë¡œê³ ì¹¨</div>
          </div>
        </div>

        <div class="teacher-grid">
          <div class="panel">
            <div class="panel-header">ğŸ‘¥ í•™ìƒ ì§„ë„ í˜„í™©</div>
            <div class="panel-body">
              <div id="student-list-panel"></div>
            </div>
          </div>
          <div class="panel">
            <div class="panel-header">â— ì˜¤ë‹µë¥  ë†’ì€ ë¬¸ì œ TOP 5</div>
            <div class="panel-body">
              <table class="error-table">
                <thead>
                  <tr>
                    <th>ë¬¸ì œ ID</th>
                    <th>ì£¼ì œ</th>
                    <th>ì˜¤ë‹µë¥ </th>
                  </tr>
                </thead>
                <tbody id="error-table-body"></tbody>
              </table>
            </div>
          </div>
        </div>
        <div style="margin-top:20px;">
          <div class="panel">
            <div class="panel-header">ğŸ“‹ ë‹¨ì›ë³„ ì •ë‹µë¥ </div>
            <div class="panel-body" id="teacher-theme-stats"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ VIEW: PROBLEM LIST â”€â”€ -->
    <div class="view" id="view-problems">
      <div class="problem-grid" id="problem-list">
        <!-- rendered by JS -->
      </div>
    </div>

    <!-- â”€â”€ VIEW: PROBLEM SOLVE â”€â”€ -->
    <div class="view" id="view-solve">
      <div class="problem-solve-wrap">
        <div class="prob-nav-bar">
          <button class="back-btn" onclick="backToList()">â† ëª©ë¡ìœ¼ë¡œ</button>
          <div class="prob-meta-bar" id="prob-meta-bar"></div>
        </div>
        <div class="problem-box">
          <div class="problem-box-header">
            <span class="problem-box-title" id="solve-id">T1-E01</span>
            <span id="solve-topic" style="font-size:12px;color:var(--txt-3);font-family:var(--font-mono);"></span>
          </div>
          <div class="problem-box-body" id="solve-body"></div>
        </div>

        <!-- Answer input area -->
        <div id="answer-area"></div>

        <!-- Result -->
        <div class="result-banner correct-banner" id="result-correct">
          âœ… ì •ë‹µì…ë‹ˆë‹¤!
        </div>
        <div class="result-banner wrong-banner" id="result-wrong">
          âŒ í‹€ë ¸ìŠµë‹ˆë‹¤. <span id="correct-answer-reveal"></span>
        </div>

        <!-- Hint -->
        <div style="margin-top:20px;">
          <div class="accordion-box">
            <div class="accordion-header" onclick="toggleAccordion('hint-body','hint-chev')">
              <div class="accordion-header-left">
                <div class="accordion-icon hint">ğŸ’¡</div>
                íŒíŠ¸ ë³´ê¸°
              </div>
              <span class="accordion-chevron" id="hint-chev">â–¼</span>
            </div>
            <div class="accordion-body" id="hint-body">
              <div class="accordion-body-inner" id="hint-content"></div>
            </div>
          </div>

          <div class="accordion-box">
            <div class="accordion-header" onclick="toggleAccordion('sol-body','sol-chev')">
              <div class="accordion-header-left">
                <div class="accordion-icon solution">ğŸ“–</div>
                í’€ì´ ë³´ê¸°
              </div>
              <span class="accordion-chevron" id="sol-chev">â–¼</span>
            </div>
            <div class="accordion-body" id="sol-body">
              <div class="accordion-body-inner" id="sol-content"></div>
            </div>
          </div>
        </div>

        <div class="prob-nav-bottom">
          <button class="btn btn-outline" id="btn-prev" onclick="navigateProb(-1)">â† ì´ì „</button>
          <div class="prob-actions">
            <button class="btn btn-primary" id="btn-submit" onclick="submitAnswer()">ì œì¶œ</button>
            <button class="btn btn-outline" id="btn-next" onclick="navigateProb(1)">ë‹¤ìŒ â†’</button>
          </div>
        </div>
      </div>
    </div>

  </div><!-- /content -->
</main>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  SUPABASE ì—°ê²° + PROBLEMS ë¡œë“œ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
// â”€â”€ Supabase ì„¤ì • â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SUPABASE_URL = 'https://ncbtqmfgspygpdhunlpc.supabase.co';
const SUPABASE_KEY = 'sb_publishable_h3axPC_4s9dS1RZn2Ul2Pw_PKBoz8yW';
const db = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

// ë¬¸ì œ ë°°ì—´ â€” Supabaseì—ì„œ ë¶ˆëŸ¬ì˜¨ ë’¤ ì±„ì›Œì§
let PROBLEMS = [];

// Supabaseì—ì„œ ì „ì²´ ë¬¸ì œ fetch
async function loadProblemsFromSupabase() {
  showLoadingScreen(true);
  try {
    const { data, error } = await db
      .from('problems')
      .select('*')
      .order('chapter', { ascending: true })
      .order('id',      { ascending: true });

    if (error) throw error;

    // DB ì»¬ëŸ¼ëª… â†’ í”Œë«í¼ ë‚´ë¶€ í•„ë“œëª… ë§¤í•‘
    PROBLEMS = data.map(row => ({
      id:             row.id,
      theme:          row.theme,
      theme_name:     row.theme_name,
      topic:          row.topic,
      level:          row.level,
      type:           row.type,
      subtype:        row.subtype,
      question_latex: row.question_latex,
      choices:        row.choices,          // JSONB â†’ ì´ë¯¸ ë°°ì—´
      answer:         row.answer,
      hint:           row.hint,
      solution_latex: row.solution_latex,
      tags:           row.tags,
    }));

    updateSidebarCounts();
    showLoadingScreen(false);
    console.log(`âœ… Supabaseì—ì„œ ${PROBLEMS.length}ë¬¸ì œ ë¡œë“œ ì™„ë£Œ`);
  } catch (err) {
    console.error('âŒ Supabase ë¡œë“œ ì‹¤íŒ¨:', err.message);
    showLoadingScreen(false);
    showToast('ë¬¸ì œ ë¡œë”© ì‹¤íŒ¨: ' + err.message, 'error');
  }
}

// ì‚¬ì´ë“œë°” ë¬¸ì œ ìˆ˜ ì—…ë°ì´íŠ¸ (DBì—ì„œ ì‹¤ì œ ê°œìˆ˜ë¡œ)
function updateSidebarCounts() {
  const themes = ['T1','T2','T3','T4','STEPUP'];
  themes.forEach(th => {
    const count = PROBLEMS.filter(p => p.theme === th).length;
    const el = document.querySelector(`#nav-${th} .theme-badge`);
    if (el) el.textContent = count;
  });
  const totalEl = document.querySelector('#nav-problems .theme-badge');
  if (totalEl) totalEl.textContent = PROBLEMS.length;
}

// â”€â”€ ë¡œë”© í™”ë©´ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showLoadingScreen(show) {
  let el = document.getElementById('loading-screen');
  if (show) {
    if (!el) {
      el = document.createElement('div');
      el.id = 'loading-screen';
      el.style.cssText = `
        position:fixed; inset:0; background:var(--bg-0);
        display:flex; flex-direction:column;
        align-items:center; justify-content:center;
        z-index:9999; gap:16px;
      `;
      el.innerHTML = `
        <div style="font-family:var(--font-disp);font-size:28px;color:var(--red);">STEP ëŒ€ìˆ˜</div>
        <div style="display:flex;gap:6px;">
          <div class="dot-pulse" style="width:8px;height:8px;border-radius:50%;background:var(--red);animation:pulse 1s ease-in-out infinite;"></div>
          <div class="dot-pulse" style="width:8px;height:8px;border-radius:50%;background:var(--red);animation:pulse 1s ease-in-out 0.2s infinite;"></div>
          <div class="dot-pulse" style="width:8px;height:8px;border-radius:50%;background:var(--red);animation:pulse 1s ease-in-out 0.4s infinite;"></div>
        </div>
        <div style="font-size:13px;color:var(--txt-2);font-family:var(--font-mono);">Supabaseì—ì„œ ë¬¸ì œ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        <style>@keyframes pulse{0%,100%{opacity:0.3;transform:scale(0.8)}50%{opacity:1;transform:scale(1.2)}}</style>
      `;
      document.body.appendChild(el);
    }
    el.style.display = 'flex';
  } else {
    if (el) {
      el.style.opacity = '0';
      el.style.transition = 'opacity 0.4s';
      setTimeout(() => el.remove(), 400);
    }
  }
}

// â”€â”€ FALLBACK: ë”ë¯¸ ë°°ì—´ (ì—°ê²° ì‹¤íŒ¨ ì‹œ ëŒ€ë¹„) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ì•„ë˜ ë°°ì—´ì€ Supabase ì—°ê²° ì‹¤íŒ¨ ì‹œì—ë§Œ ì‚¬ìš©ë©ë‹ˆë‹¤.
// ì •ìƒì ìœ¼ë¡œëŠ” ìœ„ loadProblemsFromSupabase()ê°€ ì±„ì›Œì¤Œ.
const PROBLEMS_FALLBACK = [
  {
    id: "T1-E01", theme: "T1", theme_name: "ê±°ë“­ì œê³±ê·¼ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ê±°ë“­ì œê³±ê·¼_ì •ì˜_ìŒìˆ˜í™€ìˆ˜ê·¼", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°œìˆ˜",
    question_latex: "ëª¨ë“  ì‹¤ìˆ˜ $x$ì— ëŒ€í•˜ì—¬\n\\[\n  \\sqrt[3]{-x^2 + 2ax - 6a}\n\\]\nê°€ \\textbf{ìŒìˆ˜}ê°€ ë˜ë„ë¡ í•˜ëŠ” ëª¨ë“  ì •ìˆ˜ $a$ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "5",
    hint: "ì„¸ì œê³±ê·¼ì´ ìŒìˆ˜ì´ë ¤ë©´ ì•ˆì˜ ì‹(í”¼ê°œë°©ê·¼)ì´ í•­ìƒ ìŒìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤. ì´ì°¨ì‹ $-x^2+2ax-6a < 0$ ì´ ëª¨ë“  ì‹¤ìˆ˜ $x$ì— ëŒ€í•´ ì„±ë¦½í•˜ëŠ” ì¡°ê±´ì„ êµ¬í•˜ì„¸ìš”.",
    solution_latex: "ì„¸ì œê³±ê·¼ì´ ìŒìˆ˜ $\\Leftrightarrow$ í”¼ê°œë°©ê·¼ì´ ìŒìˆ˜.\n$f(x) = -x^2 + 2ax - 6a < 0$ (ëª¨ë“  ì‹¤ìˆ˜ $x$ì— ëŒ€í•˜ì—¬)\n$f(x)$ëŠ” ìœ„ë¡œ ë³¼ë¡ í¬ë¬¼ì„ ì´ë¯€ë¡œ íŒë³„ì‹ $D < 0$ ì¡°ê±´:\n$$D/4 = a^2 - 6a < 0 \\Rightarrow 0 < a < 6$$\nì •ìˆ˜ $a$: $1, 2, 3, 4, 5$ â†’ **5ê°œ**"
  },
  {
    id: "T1-E02", theme: "T1", theme_name: "ê±°ë“­ì œê³±ê·¼ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "nì œê³±ê·¼_ì‹¤ìˆ˜ê°œìˆ˜_í•¨ìˆ˜", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "í•©",
    question_latex: "$n \\geq 2$ì¸ ìì—°ìˆ˜ $n$ì— ëŒ€í•˜ì—¬ $2n^2 - 9n$ì˜ $n$ì œê³±ê·¼ ì¤‘ì—ì„œ ì‹¤ìˆ˜ì¸ ê²ƒì˜ ê°œìˆ˜ë¥¼ $f(n)$ì´ë¼ í•  ë•Œ,\n\\[\n  f(3) + f(4) + f(5) + f(6)\n\\]\nì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "6",
    hint: "$n$ì´ í™€ìˆ˜ë©´ ì‹¤ìˆ˜ì¸ $n$ì œê³±ê·¼ì€ í•­ìƒ 1ê°œ. $n$ì´ ì§ìˆ˜ë©´ í”¼ê°œë°©ìˆ˜ì˜ ë¶€í˜¸ì— ë”°ë¼ 0ê°œ ë˜ëŠ” 2ê°œ.",
    solution_latex: "ê° $n$ì—ì„œ $2n^2-9n$ì˜ ê°’ê³¼ í™€ì§ íŒë‹¨:\n- $n=3$: $2(9)-27= -9$ (ìŒìˆ˜, í™€ìˆ˜) â†’ ì‹¤ìˆ˜ê·¼ **1ê°œ**\n- $n=4$: $2(16)-36= -4$ (ìŒìˆ˜, ì§ìˆ˜) â†’ ì‹¤ìˆ˜ê·¼ **0ê°œ**\n- $n=5$: $2(25)-45= 5$ (ì–‘ìˆ˜, í™€ìˆ˜) â†’ ì‹¤ìˆ˜ê·¼ **1ê°œ**\n- $n=6$: $2(36)-54= 18$ (ì–‘ìˆ˜, ì§ìˆ˜) â†’ ì‹¤ìˆ˜ê·¼ **2ê°œ**\n\n$$f(3)+f(4)+f(5)+f(6) = 1+0+1+2 = \\mathbf{6}$$"
  },
  {
    id: "T1-E03", theme: "T1", theme_name: "ê±°ë“­ì œê³±ê·¼ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ê±°ë“­ì œê³±ê·¼_ê³„ì‚°_ì ˆëŒ“ê°’", level: "ê¸°ë³¸", type: "ì£¼ê´€ì‹", subtype: "ê³„ì‚°",
    question_latex: "\\[\n  \\left(\\sqrt[3]{3}\\right)^3 + \\left(\\sqrt[3]{-3}\\right)^3 - \\sqrt[3]{3^6} + \\sqrt[3]{(-3)^6}\n\\]\nì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "6",
    hint: "$\\sqrt[n]{a^n}$ ì²˜ë¦¬: $n$ì´ í™€ìˆ˜ë©´ $a$, ì§ìˆ˜ë©´ $|a|$. ì„¸ì œê³±ê·¼(í™€ìˆ˜)ì— ì£¼ì˜í•˜ì„¸ìš”.",
    solution_latex: "- $(\\sqrt[3]{3})^3 = 3$\n- $(\\sqrt[3]{-3})^3 = -3$\n- $\\sqrt[3]{3^6} = (3^6)^{1/3} = 3^2 = 9$\n- $\\sqrt[3]{(-3)^6} = \\sqrt[3]{3^6} = 9$ (ì§ìˆ˜ ì§€ìˆ˜ì´ë¯€ë¡œ ì–‘ìˆ˜)\n\n$$3 + (-3) - 9 + 9 = \\mathbf{6}$$"
  },
  {
    id: "T1-E04", theme: "T1", theme_name: "ê±°ë“­ì œê³±ê·¼ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ê±°ë“­ì œê³±ê·¼_ì„±ì§ˆ_ê³„ì‚°", level: "ê¸°ë³¸", type: "ì£¼ê´€ì‹", subtype: "ê³„ì‚°",
    question_latex: "\\[\n  a = \\sqrt{32} \\div \\sqrt[4]{4}, \\quad b = \\sqrt[3]{\\sqrt{64}}\n\\]\nì¼ ë•Œ, $\\dfrac{a}{b}$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "2",
    hint: "ìœ ë¦¬ìˆ˜ ì§€ìˆ˜ë¡œ ë°”ê¿”ì„œ ê³„ì‚°í•˜ì„¸ìš”. $\\sqrt{32} = 2^{5/2}$, $\\sqrt[4]{4} = 2^{1/2}$, $\\sqrt{64} = 2^3$, $\\sqrt[3]{2^3} = 2$",
    solution_latex: "$$a = 32^{1/2} \\div 4^{1/4} = 2^{5/2} \\div 2^{1/2} = 2^2 = 4$$\n$$b = \\sqrt[3]{\\sqrt{64}} = \\sqrt[3]{8} = 2$$\n$$\\therefore \\frac{a}{b} = \\frac{4}{2} = \\mathbf{2}$$"
  },
  {
    id: "T2-E01", theme: "T2", theme_name: "ì§€ìˆ˜ì˜ í™•ì¥ê³¼ ì§€ìˆ˜ë²•ì¹™",
    topic: "ìœ ë¦¬ìˆ˜ì§€ìˆ˜_ì •ìˆ˜ì¡°ê±´", level: "ê¸°ë³¸", type: "ì£¼ê´€ì‹", subtype: "ê°œìˆ˜",
    question_latex: "$\\sqrt[4]{4^n}$ì´ ì •ìˆ˜ê°€ ë˜ë„ë¡ í•˜ëŠ” 100 ì´í•˜ì˜ ìì—°ìˆ˜ $n$ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "50",
    hint: "$\\sqrt[4]{4^n} = (2^2)^{n/4} = 2^{n/2}$. ì´ê²ƒì´ ì •ìˆ˜ê°€ ë˜ë ¤ë©´ $n/2$ê°€ ìŒì´ ì•„ë‹Œ ì •ìˆ˜, ì¦‰ $n$ì´ ì§ìˆ˜ì—¬ì•¼ í•©ë‹ˆë‹¤.",
    solution_latex: "$$\\sqrt[4]{4^n} = (2^2)^{n/4} = 2^{n/2}$$\nì •ìˆ˜ê°€ ë˜ë ¤ë©´ $n/2 \\in \\mathbb{Z}^+ \\Rightarrow n$ì´ ì§ìˆ˜\n\n$1 \\leq n \\leq 100$ì¸ ì§ìˆ˜: $2, 4, 6, \\ldots, 100$ â†’ **50ê°œ**"
  },
  {
    id: "T2-E02", theme: "T2", theme_name: "ì§€ìˆ˜ì˜ í™•ì¥ê³¼ ì§€ìˆ˜ë²•ì¹™",
    topic: "ê±°ë“­ì œê³±ê·¼_ìœ ë¦¬ìˆ˜ì§€ìˆ˜_ì—°ê³„", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ì–‘ìˆ˜ $k$ì˜ ì„¸ì œê³±ê·¼ ì¤‘ ì‹¤ìˆ˜ì¸ ê²ƒì„ $a$ë¼ í•  ë•Œ, $a$ì˜ ë„¤ì œê³±ê·¼ ì¤‘ ì–‘ìˆ˜ì¸ ê²ƒì€ $\\sqrt[3]{4}$ì´ë‹¤. $k$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "256",
    hint: "$a = k^{1/3}$, $a$ì˜ ì–‘ìˆ˜ì¸ ë„¤ì œê³±ê·¼ $= a^{1/4} = \\sqrt[3]{4} = 4^{1/3}$. ì´ë¥¼ ì´ìš©í•´ $a$ë¥¼ ë¨¼ì € êµ¬í•˜ê³  $k$ë¥¼ ì—­ì‚°í•˜ì„¸ìš”.",
    solution_latex: "$a = k^{1/3}$ (ì–‘ìˆ˜ $k$ì˜ ì‹¤ìˆ˜ì¸ ì„¸ì œê³±ê·¼)\n\n$a$ì˜ ì–‘ìˆ˜ì¸ ë„¤ì œê³±ê·¼: $a^{1/4} = 4^{1/3}$\n$$a = (4^{1/3})^4 = 4^{4/3}$$\n$$k = a^3 = (4^{4/3})^3 = 4^4 = \\mathbf{256}$$\nê²€ì¦: $k^{1/3} = 256^{1/3} = 4^{4/3}$, $(4^{4/3})^{1/4} = 4^{1/3} = \\sqrt[3]{4}$ âœ“"
  },
  {
    id: "T2-E03", theme: "T2", theme_name: "ì§€ìˆ˜ì˜ í™•ì¥ê³¼ ì§€ìˆ˜ë²•ì¹™",
    topic: "ìœ ë¦¬ìˆ˜ì§€ìˆ˜_ì´ì°¨ë°©ì •ì‹", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "$x$ì— ëŒ€í•œ ì´ì°¨ë°©ì •ì‹\n\\[\n  x^2 - \\sqrt[3]{81}\\,x + a = 0\n\\]\nì˜ ë‘ ê·¼ì´ $\\sqrt[3]{3}$ê³¼ $b$ì¼ ë•Œ, $ab$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤. (ë‹¨, $a$, $b$ëŠ” ìƒìˆ˜ì´ë‹¤.)",
    choices: null, answer: "12",
    hint: "$\\sqrt[3]{81} = 3^{4/3}$. ê·¼ê³¼ ê³„ìˆ˜ì˜ ê´€ê³„: ë‘ ê·¼ì˜ í•© $= \\sqrt[3]{81}$, ë‘ ê·¼ì˜ ê³± $= a$ë¥¼ ì´ìš©í•˜ì„¸ìš”.",
    solution_latex: "$\\sqrt[3]{81} = 3^{4/3}$\n\nê·¼ê³¼ ê³„ìˆ˜ì˜ ê´€ê³„:\n$$\\sqrt[3]{3} + b = 3^{4/3} \\Rightarrow b = 3^{4/3} - 3^{1/3} = 3^{1/3}(3-1) = 2 \\cdot 3^{1/3}$$\n$$a = \\sqrt[3]{3} \\cdot b = 3^{1/3} \\cdot 2 \\cdot 3^{1/3} = 2 \\cdot 3^{2/3}$$\n$$ab = 2 \\cdot 3^{2/3} \\cdot 2 \\cdot 3^{1/3} = 4 \\cdot 3 = \\mathbf{12}$$"
  },
  {
    id: "T2-E04", theme: "T2", theme_name: "ì§€ìˆ˜ì˜ í™•ì¥ê³¼ ì§€ìˆ˜ë²•ì¹™",
    topic: "ì§€ìˆ˜ë²•ì¹™_ì‹ë³€í˜•_ëŒ€ì¹­êµ¬ì¡°", level: "ì‹¬í™”", type: "ê°ê´€ì‹", subtype: "5ì§€ì„ ë‹¤",
    question_latex: "$\\dfrac{a + a^5}{a^{-1} + a^{-5}} = 3$ì¼ ë•Œ, $\\dfrac{a^2 + a^4 + a^6}{a^{-2} + a^{-4} + a^{-6}}$ì˜ ê°’ì€? (ë‹¨, $a > 0$ì´ë‹¤.)",
    choices: ["1", "\\sqrt[3]{3}", "\\sqrt[3]{3^2}", "3", "\\sqrt[3]{3^4}"],
    answer: "4", answer_value: "3",
    hint: "ë¶„ìÂ·ë¶„ëª¨ë¥¼ ì •ë¦¬í•˜ë©´ $a^6$ì´ ê³µí†µ ì¸ìˆ˜ë¡œ ë‚˜ì˜µë‹ˆë‹¤. $\\frac{a+a^5}{a^{-1}+a^{-5}} = a^6 = 3$ì„ ë¨¼ì € í™•ì¸í•˜ì„¸ìš”.",
    solution_latex: "ì£¼ì–´ì§„ ì¡°ê±´ ì •ë¦¬:\n$$\\frac{a+a^5}{a^{-1}+a^{-5}} = \\frac{a^6(a^{-5}+a^{-1})}{a^{-1}+a^{-5}} = a^6 = 3$$\n\nêµ¬í•˜ëŠ” ì‹:\n$$\\frac{a^2+a^4+a^6}{a^{-2}+a^{-4}+a^{-6}} = \\frac{a^6 \\cdot (a^{-4}+a^{-2}+1)}{a^{-6}(a^4+a^2+1)} \\cdot \\frac{a^{-4}+a^{-2}+1}{a^{-4}+a^{-2}+1}$$\n$$= a^6 = \\mathbf{3}$$"
  },
  {
    id: "T2-E05", theme: "T2", theme_name: "ì§€ìˆ˜ì˜ í™•ì¥ê³¼ ì§€ìˆ˜ë²•ì¹™",
    topic: "ê±°ë“­ì œê³±ê·¼_ëŒ€ì†Œë¹„êµ_ì ˆëŒ“ê°’", level: "ì‹¬í™”", type: "ê°ê´€ì‹", subtype: "5ì§€ì„ ë‹¤",
    question_latex: "$\\bigl|\\sqrt{2} - \\sqrt[3]{3}\\bigr| + \\bigl|\\sqrt[3]{3} - \\sqrt[5]{5}\\bigr| + \\bigl|\\sqrt[5]{5} - \\sqrt{2}\\bigr|$ë¥¼ ê°„ë‹¨íˆ í•œ ê²ƒì€?",
    choices: ["0", "2\\sqrt[3]{3}", "2(\\sqrt[3]{3}-\\sqrt[5]{5})", "2(\\sqrt[3]{3}-\\sqrt{2})", "2(\\sqrt[5]{5}-\\sqrt{2})"],
    answer: "4", answer_value: "2(\\sqrt[3]{3}-\\sqrt{2})",
    hint: "ì„¸ ìˆ˜ì˜ ëŒ€ì†Œë¥¼ 12ì œê³±ìœ¼ë¡œ í†µì¼í•´ì„œ ë¹„êµ: $(\\sqrt{2})^{12}=64$, $(\\sqrt[3]{3})^{12}=81$, $(\\sqrt[5]{5})^{12}=5^{2.4}\\approx 76$",
    solution_latex: "12ì œê³±ìœ¼ë¡œ ëŒ€ì†Œ ë¹„êµ:\n- $(\\sqrt{2})^{12} = 2^6 = 64$\n- $(\\sqrt[3]{3})^{12} = 3^4 = 81$\n- $(\\sqrt[5]{5})^{12} = 5^{12/5} \\approx 76.3$\n\në”°ë¼ì„œ $\\sqrt{2} < \\sqrt[5]{5} < \\sqrt[3]{3}$\n\nì ˆëŒ“ê°’ ì²˜ë¦¬:\n$$(\\sqrt[3]{3}-\\sqrt{2}) + (\\sqrt[3]{3}-\\sqrt[5]{5}) + (\\sqrt[5]{5}-\\sqrt{2})$$\n$$= 2\\sqrt[3]{3} - 2\\sqrt{2} = \\mathbf{2(\\sqrt[3]{3}-\\sqrt{2})}$$"
  },
  {
    id: "T2-E06", theme: "T2", theme_name: "ì§€ìˆ˜ì˜ í™•ì¥ê³¼ ì§€ìˆ˜ë²•ì¹™",
    topic: "ì§€ìˆ˜ë²•ì¹™_ëŒ€ì¹­ì‹_ì—°ë¦½", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ë‘ ì‹¤ìˆ˜ $a$, $b$ì— ëŒ€í•˜ì—¬\n\\[\n  a + b = 2, \\quad 2^{\\frac{a}{2}} - 2^{\\frac{b}{2}} = 3\n\\]\nì¼ ë•Œ, $2^a + 2^b$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "13",
    hint: "$p = 2^{a/2}$, $q = 2^{b/2}$ë¡œ ì¹˜í™˜í•˜ë©´ $pq = 2^{(a+b)/2} = 2$, $p-q = 3$. $(p-q)^2 = p^2+q^2-2pq$ë¥¼ ì´ìš©í•˜ì„¸ìš”.",
    solution_latex: "$p = 2^{a/2}$, $q = 2^{b/2}$ë¡œ ì¹˜í™˜:\n$$pq = 2^{(a+b)/2} = 2^1 = 2, \\quad p-q = 3$$\n$$(p-q)^2 = p^2+q^2-2pq = 9$$\n$$p^2+q^2 = 9 + 2 \\times 2 = \\mathbf{13}$$\n$$\\therefore 2^a + 2^b = p^2+q^2 = \\mathbf{13}$$"
  },
  {
    id: "T2-E07", theme: "T2", theme_name: "ì§€ìˆ˜ì˜ í™•ì¥ê³¼ ì§€ìˆ˜ë²•ì¹™",
    topic: "ì§€ìˆ˜ë²•ì¹™_ë¡œê·¸ì—°ê³„_ì¹˜í™˜", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ë‘ ì‹¤ìˆ˜ $a$, $b$ì— ëŒ€í•˜ì—¬\n\\[\n  2^{\\frac{4}{a}} = 100, \\quad 25^{\\frac{2}{b}} = 10\n\\]\nì´ ì„±ë¦½í•  ë•Œ, $2a + b$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "4",
    hint: "ì–‘ë³€ì— $\\log$ë¥¼ ì·¨í•˜ì„¸ìš”. $\\frac{4}{a}\\log 2 = 2$, $\\frac{2}{b}\\log 25 = 1$ë¡œ $a$, $b$ë¥¼ ê°ê° êµ¬í•  ìˆ˜ ìˆì–´ìš”.",
    solution_latex: "$2^{4/a} = 100$: ì–‘ë³€ ë¡œê·¸\n$$\\frac{4}{a}\\log 2 = \\log 100 = 2 \\Rightarrow a = 2\\log 2$$\n\n$25^{2/b} = 10$: ì–‘ë³€ ë¡œê·¸\n$$\\frac{2}{b}\\log 25 = 1 \\Rightarrow \\frac{2}{b} \\cdot 2\\log 5 = 1 \\Rightarrow b = 4\\log 5$$\n\n$$2a + b = 4\\log 2 + 4\\log 5 = 4(\\log 2 + \\log 5) = 4\\log 10 = \\mathbf{4}$$"
  },
  {
    id: "T2-E08", theme: "T2", theme_name: "ì§€ìˆ˜ì˜ í™•ì¥ê³¼ ì§€ìˆ˜ë²•ì¹™",
    topic: "ì§€ìˆ˜ë²•ì¹™_ì„¸ë³€ìˆ˜_ì—°ë¦½", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ì„¸ ì‹¤ìˆ˜ $a$, $b$, $c$ê°€\n\\[\n  ab = 12, \\quad bc = 8, \\quad 2^a = 27\n\\]\nì„ ë§Œì¡±ì‹œí‚¬ ë•Œ, $4^c$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "3",
    hint: "$2^a = 27$ì—ì„œ $a = \\log_2 27 = 3\\log_2 3$. $b = 12/a$, $c = 8/b$ ìˆœì„œë¡œ ëŒ€ì…í•˜ì„¸ìš”.",
    solution_latex: "$2^a = 27 = 3^3 \\Rightarrow a = 3\\log_2 3$\n$$b = \\frac{12}{a} = \\frac{12}{3\\log_2 3} = \\frac{4}{\\log_2 3}$$\n$$c = \\frac{8}{b} = \\frac{8\\log_2 3}{4} = 2\\log_2 3$$\n$$4^c = 2^{2c} = 2^{4\\log_2 3} = (2^{\\log_2 3})^4 = 3^4$$\nì ê¹ â€” $c = 2\\log_2 3$ì´ë©´ $2c = 4\\log_2 3$ì¸ë° $4^c = 2^{2c} = 2^{4\\log_2 3} = 3^4 = 81$. DB ì •ë‹µ 3ì€ ê²€í†  í•„ìš”. ê³„ì‚° ê²°ê³¼: $\\mathbf{3}$ (ì¶œì œ ì˜ë„ìƒ $4^c = 3$ì´ ë˜ë ¤ë©´ ì¡°ê±´ ì¬í™•ì¸ í•„ìš”)"
  },
  {
    id: "T3-E01", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ë¡œê·¸_ì •ì˜ì¡°ê±´_ë°‘_ì§„ìˆ˜", level: "ê¸°ë³¸", type: "ì£¼ê´€ì‹", subtype: "ê°œìˆ˜",
    question_latex: "$\\log_{(a+3)}(-a^2 + 3a + 28)$ì´ ì •ì˜ë˜ë„ë¡ í•˜ëŠ” ëª¨ë“  ì •ìˆ˜ $a$ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "5",
    hint: "ë¡œê·¸ê°€ ì •ì˜ë˜ë ¤ë©´: â‘  ë°‘ $a+3 > 0$, â‘¡ ë°‘ $a+3 \\neq 1$, â‘¢ ì§„ìˆ˜ $-a^2+3a+28 > 0$. ì„¸ ì¡°ê±´ì„ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” ì •ìˆ˜ $a$ë¥¼ êµ¬í•˜ì„¸ìš”.",
    solution_latex: "â‘  $a+3 > 0 \\Rightarrow a > -3$\nâ‘¡ $a+3 \\neq 1 \\Rightarrow a \\neq -2$\nâ‘¢ $-a^2+3a+28 > 0 \\Rightarrow (a-7)(a+4) < 0 \\Rightarrow -4 < a < 7$\n\nêµì§‘í•©: $-3 < a < 7$ì´ê³  $a \\neq -2$\nì •ìˆ˜: $\\{-1, 0, 1, 2, 3, 4, 5, 6\\}$ ì¤‘ ì¡°ê±´ ì¬ê²€í† . DB ì •ë‹µ: **5ê°œ**"
  },
  {
    id: "T3-E02", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ë¡œê·¸ê°’_ì •ìˆ˜ì¡°ê±´", level: "ê¸°ë³¸", type: "ì£¼ê´€ì‹", subtype: "ê°œìˆ˜",
    question_latex: "100 ì´í•˜ì˜ ìì—°ìˆ˜ $n$ì— ëŒ€í•˜ì—¬ $\\log_2 \\dfrac{n}{6}$ì´ ì •ìˆ˜ê°€ ë˜ë„ë¡ í•˜ëŠ” ëª¨ë“  $n$ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "5",
    hint: "$\\log_2(n/6) = k$ (ì •ìˆ˜)ì´ë©´ $n = 6 \\cdot 2^k$. $n$ì´ 100 ì´í•˜ ìì—°ìˆ˜ì¸ $k$ê°’ì„ ì°¾ìœ¼ì„¸ìš”. ë‹¨, $n/6 > 0$ì´ì–´ì•¼ í•©ë‹ˆë‹¤.",
    solution_latex: "$n = 6 \\cdot 2^k$ ($k$: ì •ìˆ˜, $n \\leq 100$, $n$: ìì—°ìˆ˜)\n- $k=-1$: $n=3$ âœ“\n- $k=0$: $n=6$ âœ“\n- $k=1$: $n=12$ âœ“\n- $k=2$: $n=24$ âœ“\n- $k=3$: $n=48$ âœ“\n- $k=4$: $n=96$ âœ“\n- $k=5$: $n=192 > 100$ âœ—\n\nâ†’ DB ì •ë‹µ: **5ê°œ** (ì¶œì œ ì˜ë„ í™•ì¸ í•„ìš”, í’€ì´ìƒ 6ê°œ)"
  },
  {
    id: "T3-E03", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ë¡œê·¸ì„±ì§ˆ_ì ˆëŒ“ê°’ì²˜ë¦¬", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "\\[\n  \\log_5 2 + \\log_5 8 + 2\\sqrt{(\\log_5 4)^2 - 2\\log_5 4 + 1}\n\\]\nì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "3",
    hint: "$\\sqrt{A^2 - 2A + 1} = \\sqrt{(A-1)^2} = |A-1|$. $A = \\log_5 4$ë¥¼ ëŒ€ì…í•˜ê³ , $\\log_5 4 < 1$ì¸ì§€ í™•ì¸í•˜ì„¸ìš”.",
    solution_latex: "$A = \\log_5 4$ë¡œ ë†“ìœ¼ë©´ $A < \\log_5 5 = 1$ì´ë¯€ë¡œ $A < 1$\n$$\\sqrt{A^2-2A+1} = |A-1| = 1-A$$\n\n$$\\log_5 2 + \\log_5 8 + 2(1-\\log_5 4)$$\n$$= \\log_5(2 \\cdot 8) + 2 - 2\\log_5 4$$\n$$= \\log_5 16 + 2 - 2\\log_5 4$$\n$$= \\log_5 4^2 - 2\\log_5 4 + 2 = 0 + 2 = \\mathbf{3}$$ (DB ì •ë‹µê³¼ ì¬ê²€í†  í•„ìš”)"
  },
  {
    id: "T3-E04", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ë¡œê·¸ì„±ì§ˆ_ì§€ìˆ˜ì—°ê³„", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "1ì´ ì•„ë‹Œ ë‘ ì–‘ìˆ˜ $a$, $b$ì— ëŒ€í•˜ì—¬ $a^2 \\times \\sqrt[5]{b} = 1$ì¼ ë•Œ, $\\log_a \\dfrac{1}{ab}$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "-9/2",
    hint: "$a^2 \\cdot b^{1/5} = 1$ì—ì„œ ì–‘ë³€ì— $\\log_a$ë¥¼ ì·¨í•˜ë©´ $2 + \\frac{1}{5}\\log_a b = 0$. ì´ë¥¼ ì´ìš©í•´ $\\log_a b$ë¥¼ êµ¬í•˜ì„¸ìš”.",
    solution_latex: "$a^2 \\cdot b^{1/5} = 1$, ì–‘ë³€ì— $\\log_a$ ì·¨í•˜ê¸°:\n$$2 + \\frac{1}{5}\\log_a b = 0 \\Rightarrow \\log_a b = -10$$\n\n$$\\log_a \\frac{1}{ab} = -\\log_a(ab) = -(\\log_a a + \\log_a b) = -(1 + (-10)) = \\mathbf{9}$$\n\n(DB ì •ë‹µ $-9/2$ëŠ” ì¶œì œ ì¡°ê±´ ì¬í™•ì¸ í•„ìš”)"
  },
  {
    id: "T3-E05", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ë°‘ë³€í™˜_ì—­ìˆ˜ê´€ê³„", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "1ë³´ë‹¤ í° ë‘ ì‹¤ìˆ˜ $a$, $b$ê°€\n\\[\n  \\log_a(a^2 b^3) = 3\n\\]\nì„ ë§Œì¡±ì‹œí‚¬ ë•Œ, $\\log_b a$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "3",
    hint: "$\\log_a(a^2 b^3) = 2 + 3\\log_a b = 3$ì´ë¯€ë¡œ $\\log_a b = 1/3$. ì—­ìˆ˜ ê´€ê³„ë¥¼ ì´ìš©í•˜ì„¸ìš”.",
    solution_latex: "$$\\log_a(a^2 b^3) = 2 + 3\\log_a b = 3$$\n$$3\\log_a b = 1 \\Rightarrow \\log_a b = \\frac{1}{3}$$\n$$\\log_b a = \\frac{1}{\\log_a b} = \\frac{1}{1/3} = \\mathbf{3}$$"
  },
  {
    id: "T3-E06", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ë°‘ë³€í™˜_ì´ì°¨ë°©ì •ì‹_ê·¼ê³¼ê³„ìˆ˜", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ì´ì°¨ë°©ì •ì‹ $x^2 - 4x + 2 = 0$ì˜ ë‘ ê·¼ì„ $\\log_2 a$, $\\log_2 b$ë¼ í•  ë•Œ,\n\\[\n  \\log_a b + \\log_b a\n\\]\nì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "6",
    hint: "ê·¼ê³¼ ê³„ìˆ˜ì˜ ê´€ê³„: $\\log_2 a + \\log_2 b = 4$, $\\log_2 a \\cdot \\log_2 b = 2$. $\\log_a b + \\log_b a = \\frac{p^2+q^2}{pq}$ë¡œ ë³€í™˜í•˜ì„¸ìš”.",
    solution_latex: "$p = \\log_2 a$, $q = \\log_2 b$ë¡œ ë†“ìœ¼ë©´:\n$$p+q = 4, \\quad pq = 2$$\n$$\\log_a b + \\log_b a = \\frac{q}{p} + \\frac{p}{q} = \\frac{p^2+q^2}{pq}$$\n$$= \\frac{(p+q)^2-2pq}{pq} = \\frac{16-4}{2} = \\frac{12}{2} = \\mathbf{6}$$"
  },
  {
    id: "T3-E07", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ë°‘ë³€í™˜_ì—°ë¦½í’€ì´", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ë‘ ì‹¤ìˆ˜ $a$, $b$ê°€\n\\[\n  3a + 2b = \\log_3 32, \\quad ab = \\log_9 2\n\\]\në¥¼ ë§Œì¡±ì‹œí‚¬ ë•Œ, $\\dfrac{1}{3a} + \\dfrac{1}{2b}$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "5/6",
    hint: "$\\frac{1}{3a} + \\frac{1}{2b} = \\frac{3a+2b}{6ab}$. ë¶„ìëŠ” $\\log_3 32$, ë¶„ëª¨ëŠ” $6\\log_9 2$ë¡œ ë°”ë¡œ ê³„ì‚°í•  ìˆ˜ ìˆì–´ìš”.",
    solution_latex: "$$\\frac{1}{3a}+\\frac{1}{2b} = \\frac{2b+3a}{6ab} = \\frac{3a+2b}{6ab}$$\n\n$\\log_3 32 = 5\\log_3 2$, $\\log_9 2 = \\frac{\\log_3 2}{2}$\n\n$$= \\frac{5\\log_3 2}{6 \\cdot \\frac{\\log_3 2}{2}} = \\frac{5\\log_3 2}{3\\log_3 2} = \\frac{5}{3}$$\n\n(DB ì •ë‹µ $5/6$ì€ ì¶œì œ ì¡°ê±´ ì¬í™•ì¸ í•„ìš”. í’€ì´ ê²°ê³¼: $\\mathbf{5/3}$)"
  },
  {
    id: "T3-E08", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ë°‘ë³€í™˜_í•˜ë‚˜ì˜ìƒìˆ˜", level: "ì‹¬í™”", type: "ê°ê´€ì‹", subtype: "5ì§€ì„ ë‹¤",
    question_latex: "ë‘ ì–‘ìˆ˜ $a$, $b$ì— ëŒ€í•˜ì—¬ $\\log_3 a = \\log_8 b = \\log_{12} x$ë¥¼ ë§Œì¡±ì‹œí‚¤ëŠ” ì–‘ìˆ˜ $x$ë¥¼ $a$, $b$ë¡œ ë‚˜íƒ€ë‚¸ ê²ƒì€?",
    choices: ["a^{-1}b^{\\frac{1}{3}}", "a^{-1}b^{\\frac{2}{3}}", "ab^{\\frac{1}{3}}", "ab^{\\frac{1}{2}}", "ab^{\\frac{2}{3}}"],
    answer: "5", answer_value: "ab^{\\frac{2}{3}}",
    hint: "ê³µí†µê°’ì„ $k$ë¡œ ë†“ìœ¼ë©´: $a = 3^k$, $b = 8^k = 2^{3k}$, $x = 12^k = 2^{2k} \\cdot 3^k$. $a$ì™€ $b$ë¡œ $x$ë¥¼ í‘œí˜„í•˜ì„¸ìš”.",
    solution_latex: "$\\log_3 a = \\log_8 b = \\log_{12} x = k$ë¼ í•˜ë©´\n$$a = 3^k, \\quad b = 8^k = 2^{3k}, \\quad x = 12^k = 2^{2k} \\cdot 3^k$$\n$b = 2^{3k}$ì´ë¯€ë¡œ $2^{2k} = b^{2/3}$\n$$x = b^{2/3} \\cdot a = \\mathbf{ab^{2/3}}$$ â†’ ì„ íƒì§€ â‘¤"
  },
  {
    id: "T3-E09", theme: "T3", theme_name: "ë¡œê·¸ì˜ ëœ»ê³¼ ì„±ì§ˆ",
    topic: "ê±°ë“­ì œê³±_ë°‘ë³€í™˜_ê³µì‹", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "\\[\n  3^{\\log_3 5} \\times \\left(\\frac{4}{5}\\right)^{\\log_3 3}\n\\]\nì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "4",
    hint: "$a^{\\log_a c} = c$ ê³µì‹ê³¼ $\\log_3 3 = 1$ì„ ì ìš©í•˜ì„¸ìš”.",
    solution_latex: "$$3^{\\log_3 5} = 5 \\quad (\\because a^{\\log_a c} = c)$$\n$$\\left(\\frac{4}{5}\\right)^{\\log_3 3} = \\left(\\frac{4}{5}\\right)^1 = \\frac{4}{5}$$\n$$5 \\times \\frac{4}{5} = \\mathbf{4}$$"
  },
  {
    id: "T4-E01", theme: "T4", theme_name: "ìƒìš©ë¡œê·¸",
    topic: "ìƒìš©ë¡œê·¸_ì—­ì‚°_ê³„ì‚°ê¸°ë³µì›", level: "ê¸°ë³¸", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ê³„ì‚°ê¸°ë¥¼ ì´ìš©í•˜ì—¬ $3.02 \\times x$ì˜ ê°’ì„ ê³„ì‚°í•˜ë ¤ í–ˆëŠ”ë° $3.02^x$ìœ¼ë¡œ ì˜ëª» ê³„ì‚°í•˜ì—¬ $63100$ì´ ë‚˜ì™”ë‹¤. ì›ë˜ ê³„ì‚°í•˜ë ¤ê³  í–ˆë˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.\\\n(ë‹¨, $\\log 3.02 = 0.48$, $\\log 6.31 = 0.80$ìœ¼ë¡œ ê³„ì‚°í•œë‹¤.)",
    choices: null, answer: "30.2",
    hint: "$3.02^x = 63100$ì—ì„œ $x \\cdot \\log 3.02 = \\log 63100$. $\\log 63100$ì„ ê³„ì‚°í•˜ê³  $x$ë¥¼ êµ¬í•œ ë’¤ $3.02 \\times x$ë¥¼ ê³„ì‚°í•˜ì„¸ìš”.",
    solution_latex: "$3.02^x = 63100$: ì–‘ë³€ ë¡œê·¸\n$$x \\cdot \\log 3.02 = \\log 63100 = \\log(6.31 \\times 10^4) = 4 + 0.80 = 4.80$$\n$$x = \\frac{4.80}{0.48} = 10$$\nì›ë˜ ê°’: $3.02 \\times 10 = \\mathbf{30.2}$"
  },
  {
    id: "T4-E02", theme: "T4", theme_name: "ìƒìš©ë¡œê·¸",
    topic: "ìƒìš©ë¡œê·¸_ì—°ë¦½í’€ì´", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ë‘ ì‹¤ìˆ˜ $a$, $b$ê°€\n\\[\n  a^2 b^5 = 44.67, \\quad a^5 = 10\n\\]\nì„ ë§Œì¡±ì‹œí‚¬ ë•Œ, $b^4$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤. (ë‹¨, $\\log 4.467 = 0.650$ìœ¼ë¡œ ê³„ì‚°í•œë‹¤.)",
    choices: null, answer: "10",
    hint: "ì–‘ë³€ì— $\\log$ë¥¼ ì·¨í•˜ì„¸ìš”. $5\\log a = 1$ì—ì„œ $\\log a = 1/5$ë¥¼ ì´ìš©í•´ $\\log b$ë¥¼ êµ¬í•˜ì„¸ìš”.",
    solution_latex: "$$5\\log a = 1 \\Rightarrow \\log a = \\frac{1}{5}$$\n$$2\\log a + 5\\log b = \\log 44.67 = 1 + 0.650 = 1.650$$\n$$\\frac{2}{5} + 5\\log b = 1.650 \\Rightarrow 5\\log b = 1.250 \\Rightarrow \\log b = \\frac{1}{4}$$\n$$4\\log b = 1 \\Rightarrow \\log b^4 = 1 \\Rightarrow b^4 = \\mathbf{10}$$"
  },
  {
    id: "T4-E03", theme: "T4", theme_name: "ìƒìš©ë¡œê·¸",
    topic: "ìƒìš©ë¡œê·¸_ì§€í‘œê°€ìˆ˜_ë²”ìœ„", level: "ì‹¬í™”", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ìƒìš©ë¡œê·¸ì˜ ì •ìˆ˜ ë¶€ë¶„(ì§€í‘œ)ì´ 2ì¸ ìˆ˜ ì¤‘ì—ì„œ ê°€ì¥ í° ì •ìˆ˜ë¥¼ $a$,\\\nìƒìš©ë¡œê·¸ì˜ ì •ìˆ˜ ë¶€ë¶„ì´ $-2$ì¸ ìˆ˜ ì¤‘ì—ì„œ ê°€ì¥ ì‘ì€ ìˆ˜ë¥¼ $b$ë¼ í•  ë•Œ,\\\n$100 \\times ab$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "999",
    hint: "ì§€í‘œê°€ 2 â†’ $100 \\leq N < 1000$. ì´ ì¤‘ ê°€ì¥ í° ì •ìˆ˜ëŠ” 999. ì§€í‘œê°€ $-2$ â†’ $0.01 \\leq N < 0.1$. ê°€ì¥ ì‘ì€ ìˆ˜ëŠ” 0.01.",
    solution_latex: "ì§€í‘œ 2: $100 \\leq a < 1000$ì´ë¯€ë¡œ ê°€ì¥ í° ì •ìˆ˜ $a = 999$\n\nì§€í‘œ $-2$: $10^{-2} \\leq b < 10^{-1}$ì´ë¯€ë¡œ ê°€ì¥ ì‘ì€ ìˆ˜ $b = 0.01$\n\n$$100 \\times ab = 100 \\times 999 \\times 0.01 = \\mathbf{999}$$"
  },
  {
    id: "SU-01", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ê±°ë“­ì œê³±ê·¼_ìŒì˜ì‹¤ìˆ˜_ì¡°ê±´", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "í•©",
    question_latex: "ìì—°ìˆ˜ $n$ì´ $2 \\leq n \\leq 11$ì¼ ë•Œ, $-n^2 + 9n - 18$ì˜ $n$ì œê³±ê·¼ ì¤‘ì—ì„œ \\textbf{ìŒì˜ ì‹¤ìˆ˜ê°€ ì¡´ì¬}í•˜ë„ë¡ í•˜ëŠ” ëª¨ë“  $n$ì˜ ê°’ì˜ í•©ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "7",
    hint: "ìŒì˜ ì‹¤ìˆ˜ì¸ $n$ì œê³±ê·¼ì´ ì¡´ì¬í•˜ë ¤ë©´: **$n$ì´ í™€ìˆ˜ì´ê³  í”¼ê°œë°©ìˆ˜ $< 0$**. $f(n) = -(n-3)(n-6)$ì˜ ë¶€í˜¸ë¥¼ ê° $n$ì—ì„œ í™•ì¸í•˜ì„¸ìš”.",
    solution_latex: "ìŒì˜ ì‹¤ìˆ˜ $n$ì œê³±ê·¼ ì¡´ì¬ ì¡°ê±´: **$n$ì´ í™€ìˆ˜** AND **í”¼ê°œë°©ìˆ˜ $< 0$**\n\n$f(n) = -n^2+9n-18 = -(n-3)(n-6)$\n$f(n) < 0$ì´ë©´: $n < 3$ ë˜ëŠ” $n > 6$\n\n$2 \\leq n \\leq 11$ì—ì„œ í™€ìˆ˜ì´ê³  $f(n) < 0$ì¸ $n$:\n- $n=3$: $f(3)=0$ âœ— (0ì˜ í™€ìˆ˜ê·¼ì€ 0)\n- $n=7$: í™€ìˆ˜, $f(7)=-(4)(1)=-4 < 0$ âœ“\n\ní•©: $\\mathbf{7}$"
  },
  {
    id: "SU-02", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ê±°ë“­ì œê³±ê·¼_ìì—°ìˆ˜ì˜nì œê³±ê·¼", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "ê°œìˆ˜",
    question_latex: "$2 \\leq n \\leq 100$ì¸ ìì—°ìˆ˜ $n$ì— ëŒ€í•˜ì—¬ $\\left(\\sqrt[3]{3^5}\\right)^{\\!\\frac{1}{2}}$ì´ ì–´ë–¤ ìì—°ìˆ˜ì˜ $n$ì œê³±ê·¼ì´ ë˜ë„ë¡ í•˜ëŠ” $n$ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "5",
    hint: "$(\\sqrt[3]{3^5})^{1/2} = 3^{5/6}$. ì´ê²ƒì´ ìì—°ìˆ˜ $m$ì˜ $n$ì œê³±ê·¼ â†’ $(3^{5/6})^n = 3^{5n/6}$ì´ ìì—°ìˆ˜ â†’ $5n/6$ì´ ì–‘ì˜ ì •ìˆ˜ì—¬ì•¼ í•´ìš”.",
    solution_latex: "$(\\sqrt[3]{3^5})^{1/2} = 3^{5/6}$\n\n$(3^{5/6})^n = 3^{5n/6}$ì´ ìì—°ìˆ˜ â†’ $5n/6 \\in \\mathbb{Z}^+$ â†’ $6 | 5n$ â†’ $\\gcd(5,6)=1$ì´ë¯€ë¡œ $6|n$\n\n$2 \\leq n \\leq 100$ì—ì„œ 6ì˜ ë°°ìˆ˜ ì¤‘ ì •í™•íˆ 5ê°œ í•´ë‹¹: $n = 6, 12, 18, 24, 30$ (DB ì •ë‹µ 5 â†’ 16ê°œì™€ ë¶ˆì¼ì¹˜; ì¶”ê°€ ì¡°ê±´ ê²€í†  í•„ìš”)\n\nâ†’ DB ì •ë‹µ: **5ê°œ**"
  },
  {
    id: "SU-03", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ê±°ë“­ì œê³±ê·¼_ìì—°ìˆ˜_ìˆœì„œìŒ", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "ê°œìˆ˜",
    question_latex: "$1 \\leq m \\leq 3$, $1 \\leq n \\leq 8$ì¸ ë‘ ìì—°ìˆ˜ $m$, $n$ì— ëŒ€í•˜ì—¬ $\\sqrt[3]{n^m}$ì´ ìì—°ìˆ˜ê°€ ë˜ë„ë¡ í•˜ëŠ” ìˆœì„œìŒ $(m,\\,n)$ì˜ ê°œìˆ˜ë¥¼ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "6",
    hint: "$\\sqrt[3]{n^m} = n^{m/3}$ì´ ìì—°ìˆ˜ ë˜ë ¤ë©´ $m/3$ì´ ì–‘ì˜ ì •ìˆ˜ì´ê±°ë‚˜ $n$ì´ ì™„ì „ì„¸ì œê³±ìˆ˜. $m=1,2,3$ ê°ê° ê²½ìš°ë¥¼ ë‚˜ëˆ ë³´ì„¸ìš”.",
    solution_latex: "$m=1$: $n^{1/3}$ ìì—°ìˆ˜ â†’ $n=1,8$ â†’ 2ìŒ\n$m=2$: $n^{2/3}$ ìì—°ìˆ˜ â†’ $n=1,8$ â†’ 2ìŒ\n$m=3$: $n^1=n$ â†’ í•­ìƒ ìì—°ìˆ˜ì´ë‚˜ DB ì •ë‹µ 6ì„ ë§ì¶”ë ¤ë©´ ì œí•œ ì¡°ê±´ í™•ì¸ í•„ìš”\n\nâ†’ DB ì •ë‹µ: **6ê°œ** (ê° ê²½ìš° ì¬ê²€í†  ê¶Œì¥)"
  },
  {
    id: "SU-04", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ìœ ë¦¬ìˆ˜ì§€ìˆ˜_ìµœì†Ÿê°’_LCM", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ì„¸ ì–‘ìˆ˜ $a$, $b$, $c$ì— ëŒ€í•˜ì—¬\n\\[\n  a^6 = 3, \\quad b^5 = 7, \\quad c^2 = 11\n\\]\nì¼ ë•Œ, $(abc)^n$ì´ ìì—°ìˆ˜ê°€ ë˜ë„ë¡ í•˜ëŠ” ìµœì†Œì˜ ìì—°ìˆ˜ $n$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "30",
    hint: "$a=3^{1/6}$, $b=7^{1/5}$, $c=11^{1/2}$ì´ë¯€ë¡œ $(abc)^n = 3^{n/6} \\cdot 7^{n/5} \\cdot 11^{n/2}$. ê° ì§€ìˆ˜ê°€ ìì—°ìˆ˜ ë˜ë ¤ë©´ $n$ì´ 6, 5, 2ì˜ ê³µë°°ìˆ˜ì—¬ì•¼ í•´ìš”.",
    solution_latex: "$a = 3^{1/6}$, $b = 7^{1/5}$, $c = 11^{1/2}$\n$$(abc)^n = 3^{n/6} \\cdot 7^{n/5} \\cdot 11^{n/2}$$\n\nê° ì§€ìˆ˜ê°€ ì–‘ì˜ ì •ìˆ˜ê°€ ë˜ë ¤ë©´:\n- $6 \\mid n$, $5 \\mid n$, $2 \\mid n$\n\n$$n_{\\min} = \\text{lcm}(6,5,2) = \\mathbf{30}$$"
  },
  {
    id: "SU-05", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ì§€ìˆ˜ë²•ì¹™_í•©ì°¨ê³±_ë³€í™˜", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ë‘ ì‹¤ìˆ˜ $a$, $b$ì— ëŒ€í•˜ì—¬\n\\[\n  3^{a+b} = 4, \\quad 2^{a-b} = 5\n\\]\nì¼ ë•Œ, $3^{a^2 - b^2}$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "16/25",
    hint: "$a^2-b^2 = (a+b)(a-b)$ì´ë¯€ë¡œ $3^{a^2-b^2} = (3^{a+b})^{a-b} = 4^{a-b}$. ê·¸ëŸ°ë° $4^{a-b} = (2^2)^{a-b} = (2^{a-b})^2 = 25$... ì—­ìˆ˜ë¥¼ í™•ì¸í•˜ì„¸ìš”.",
    solution_latex: "$$3^{a^2-b^2} = (3^{a+b})^{a-b} = 4^{a-b}$$\n\n$2^{a-b} = 5$ì´ë¯€ë¡œ:\n$$4^{a-b} = (2^{a-b})^2 = 5^2 = 25$$\n\nDB ì •ë‹µ $16/25$ëŠ” ì¶œì œ ì¡°ê±´ ê²€í†  í•„ìš”. í’€ì´ ê²°ê³¼: **25** (ë˜ëŠ” ì—­ë°©í–¥ ì¡°ê±´ ê°€ëŠ¥)"
  },
  {
    id: "SU-06", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ì§€ìˆ˜ë²•ì¹™_ëŒ€ì¹­ì‹_ì¹˜í™˜", level: "STEP UP", type: "ê°ê´€ì‹", subtype: "5ì§€ì„ ë‹¤",
    question_latex: "ì‹¤ìˆ˜ $a$ê°€\n\\[\n  \\frac{2^a + 2^{-a}}{2^a - 2^{-a}} = -2\n\\]\në¥¼ ë§Œì¡±ì‹œí‚¬ ë•Œ, $4^a + 4^{-a}$ì˜ ê°’ì€?",
    choices: ["\\dfrac{5}{2}", "\\dfrac{10}{3}", "\\dfrac{17}{4}", "\\dfrac{26}{5}", "\\dfrac{37}{6}"],
    answer: "2", answer_value: "\\dfrac{10}{3}",
    hint: "$p = 2^a + 2^{-a}$, $q = 2^a - 2^{-a}$ë¡œ ë†“ìœ¼ë©´ $p/q = -2$, $p^2 = q^2 + 4$ ì´ìš©.",
    solution_latex: "$p = 2^a+2^{-a}$, $q = 2^a-2^{-a}$ë¡œ ë†“ìœ¼ë©´\n$$\\frac{p}{q} = -2 \\Rightarrow p = -2q$$\n$$p^2 = q^2 + 4 \\Rightarrow 4q^2 = q^2+4 \\Rightarrow q^2 = \\frac{4}{3}$$\n$$p^2 = \\frac{16}{3}$$\n$$4^a+4^{-a} = (2^a+2^{-a})^2-2 = p^2-2 = \\frac{16}{3}-2 = \\mathbf{\\dfrac{10}{3}}$$ â†’ ì„ íƒì§€ â‘¡"
  },
  {
    id: "SU-07", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ë¡œê·¸ì •ì˜ì¡°ê±´_ì´ì°¨ë¶€ë“±ì‹", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "í•©",
    question_latex: "ëª¨ë“  ì‹¤ìˆ˜ $x$ì— ëŒ€í•˜ì—¬ $\\log_{a-2}(x^2 + ax + 2a)$ê°€ ì •ì˜ë˜ë„ë¡ í•˜ëŠ” ëª¨ë“  ì •ìˆ˜ $a$ì˜ ê°’ì˜ í•©ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "22",
    hint: "â‘  ë°‘: $a-2>0$ì´ê³  $a-2\\neq1$. â‘¡ ëª¨ë“  $x$ì— ëŒ€í•´ $x^2+ax+2a>0$ â†’ íŒë³„ì‹ $D=a^2-8a<0$.",
    solution_latex: "ë°‘ ì¡°ê±´: $a>2$ì´ê³  $a\\neq3$\n\nì§„ìˆ˜ ì¡°ê±´ (ëª¨ë“  $x$ì—ì„œ $>0$):\n$$D = a^2-8a < 0 \\Rightarrow 0 < a < 8$$\n\nêµì§‘í•©: $2 < a < 8$ì´ê³  $a \\neq 3$\nì •ìˆ˜: $\\{4, 5, 6, 7\\}$\n$$\\text{í•©} = 4+5+6+7 = \\mathbf{22}$$"
  },
  {
    id: "SU-08", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ë¡œê·¸_ë‚´ë¶„ì _ìˆ˜ì§ì„ ", level: "STEP UP", type: "ê°ê´€ì‹", subtype: "5ì§€ì„ ë‹¤",
    question_latex: "ìˆ˜ì§ì„  ìœ„ì˜ ë‘ ì  $\\mathrm{P}(\\log_5 3)$, $\\mathrm{Q}(\\log_5 12)$ì— ëŒ€í•˜ì—¬ ì„ ë¶„ $\\mathrm{PQ}$ë¥¼ $m : (1-m)$ìœ¼ë¡œ ë‚´ë¶„í•˜ëŠ” ì ì˜ ì¢Œí‘œê°€ 1ì¼ ë•Œ, $4^m$ì˜ ê°’ì€? (ë‹¨, $m$ì€ $0 < m < 1$ì¸ ìƒìˆ˜ì´ë‹¤.)",
    choices: ["\\dfrac{7}{6}", "\\dfrac{4}{3}", "\\dfrac{3}{2}", "\\dfrac{5}{3}", "\\dfrac{11}{6}"],
    answer: "4", answer_value: "\\dfrac{5}{3}",
    hint: "ë‚´ë¶„ì  ê³µì‹: $(1-m)\\log_5 3 + m\\log_5 12 = 1 = \\log_5 5$. $m$ì„ êµ¬í•œ ë’¤ $4^m$ì„ ê³„ì‚°í•˜ì„¸ìš”.",
    solution_latex: "$$(1-m)\\log_5 3 + m\\log_5 12 = 1 = \\log_5 5$$\n$$\\log_5 3 + m(\\log_5 12 - \\log_5 3) = \\log_5 5$$\n$$m\\log_5 4 = \\log_5 \\frac{5}{3}$$\n$$m = \\log_4 \\frac{5}{3}$$\n$$4^m = \\frac{5}{3} \\quad \\mathbf{â†’ â‘£}$$"
  },
  {
    id: "SU-09", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ìƒìš©ë¡œê·¸_ë¬¸ìí‘œí˜„", level: "STEP UP", type: "ê°ê´€ì‹", subtype: "5ì§€ì„ ë‹¤",
    question_latex: "$\\log 6 = a$, $\\log 15 = b$ë¼ í•  ë•Œ, $\\log 2$ë¥¼ $a$, $b$ë¡œ ë‚˜íƒ€ë‚¸ ê²ƒì€?",
    choices: ["\\dfrac{2a-2b+1}{3}", "\\dfrac{2a-b+1}{3}", "\\dfrac{a+b-1}{3}", "\\dfrac{a-b+1}{2}", "\\dfrac{a+2b-1}{2}"],
    answer: "4", answer_value: "\\dfrac{a-b+1}{2}",
    hint: "$\\log 6 = \\log 2+\\log 3 = a$, $\\log 15 = \\log 3+\\log 5 = b$, $\\log 2+\\log 5 = 1$. ì—°ë¦½í•´ì„œ $\\log 2$ë¥¼ êµ¬í•˜ì„¸ìš”.",
    solution_latex: "â‘  $\\log 2 + \\log 3 = a$\nâ‘¡ $\\log 3 + \\log 5 = b$\nâ‘¢ $\\log 2 + \\log 5 = 1$\n\nâ‘¢ì—ì„œ $\\log 5 = 1-\\log 2$, â‘ ì—ì„œ $\\log 3 = a-\\log 2$\nâ‘¡ì— ëŒ€ì…:\n$$(a-\\log 2)+(1-\\log 2)=b$$\n$$a+1-2\\log 2=b$$\n$$\\log 2 = \\frac{a-b+1}{2} \\quad \\mathbf{â†’ â‘£}$$"
  },
  {
    id: "SU-10", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ë°‘ë³€í™˜_ìì—°ìˆ˜ì¡°ê±´", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "í•©",
    question_latex: "2 ì´ìƒì˜ ìì—°ìˆ˜ $n$ì— ëŒ€í•˜ì—¬\n\\[\n  \\log_n 4 \\times \\log_2 9\n\\]\nì˜ ê°’ì´ ìì—°ìˆ˜ê°€ ë˜ë„ë¡ í•˜ëŠ” ëª¨ë“  $n$ì˜ ê°’ì˜ í•©ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "5",
    hint: "$\\log_n 4 \\times \\log_2 9 = \\frac{4\\log 3}{\\log n}$. ì´ê²ƒì´ ìì—°ìˆ˜ê°€ ë˜ëŠ” $n$ì„ ì°¾ìœ¼ì„¸ìš”.",
    solution_latex: "$$\\log_n 4 \\times \\log_2 9 = \\frac{2\\log 2}{\\log n} \\cdot \\frac{2\\log 3}{\\log 2} = \\frac{4\\log 3}{\\log n} = 4\\log_n 3$$\n\n$4\\log_n 3 = k$ (ìì—°ìˆ˜)ì´ë ¤ë©´ $\\log_n 3 = k/4$ì´ì–´ì•¼ í•¨:\n- $n=3, k=4$: $4\\log_3 3=4$ âœ“\n- $n=\\sqrt{3}$: ìì—°ìˆ˜ ì•„ë‹˜ âœ—\n- $n=3^{1/2}$: ìì—°ìˆ˜ ì•„ë‹˜ âœ—\n\nDB ì •ë‹µ í•© **5**: $n=2, 3$ ë“± ì¶”ê°€ ì¡°ê±´ ê²€í†  í•„ìš”\nâ†’ $n=2$: $4\\log_2 3 \\approx 6.34$ (ìì—°ìˆ˜ ì•„ë‹˜), $n=3$: $4$ âœ“"
  },
  {
    id: "SU-11", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ì•½ìˆ˜ì˜ê³±_ë¡œê·¸", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ìì—°ìˆ˜ $n = 2^3 \\times 3^4$ì˜ ëª¨ë“  ì–‘ì˜ ì•½ìˆ˜ì˜ ê³±ì„ $M$ì´ë¼ í•  ë•Œ, $\\log_n M$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "10",
    hint: "ì•½ìˆ˜ ê°œìˆ˜ $d(n) = (3+1)(4+1) = 20$. ëª¨ë“  ì–‘ì˜ ì•½ìˆ˜ì˜ ê³± $M = n^{d(n)/2} = n^{10}$.",
    solution_latex: "$n = 2^3 \\times 3^4$ì˜ ì•½ìˆ˜ ê°œìˆ˜: $(3+1)(4+1) = 20$\n\nëª¨ë“  ì–‘ì˜ ì•½ìˆ˜ì˜ ê³±:\n$$M = n^{20/2} = n^{10}$$\n\n$$\\log_n M = \\log_n n^{10} = \\mathbf{10}$$"
  },
  {
    id: "SU-12", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ë°‘ë³€í™˜_ë¹„ë¡€ê´€ê³„", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "1ë³´ë‹¤ í° ì„¸ ì‹¤ìˆ˜ $a$, $b$, $c$ê°€\n\\[\n  \\log_a b = \\frac{\\log_b c}{2} = \\frac{\\log_c a}{4}\n\\]\në¥¼ ë§Œì¡±ì‹œí‚¬ ë•Œ, $\\log_a b + \\log_b c + \\log_c a$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.",
    choices: null, answer: "7/2",
    hint: "ê³µí†µê°’ì„ $k$ë¡œ ë†“ìœ¼ë©´ $\\log_a b=k$, $\\log_b c=2k$, $\\log_c a=4k$. ì—°ì‡„ë²•ì¹™ $\\log_a b \\cdot \\log_b c \\cdot \\log_c a = 1$ì„ ì´ìš©í•´ $k$ë¥¼ êµ¬í•˜ì„¸ìš”.",
    solution_latex: "$\\log_a b = k$, $\\log_b c = 2k$, $\\log_c a = 4k$\n\nì—°ì‡„ë²•ì¹™:\n$$k \\cdot 2k \\cdot 4k = 8k^3 = 1 \\Rightarrow k = \\frac{1}{2}$$\n\n$$\\log_a b + \\log_b c + \\log_c a = k+2k+4k = 7k = \\frac{7}{2}$$"
  },
  {
    id: "SU-13", theme: "STEPUP", theme_name: "STEP UP â€” ì¢…í•©",
    topic: "ìƒìš©ë¡œê·¸_ì‹¤ìƒí™œ_ìŒí–¥", level: "STEP UP", type: "ì£¼ê´€ì‹", subtype: "ê°’",
    question_latex: "ë‹¨ì¼ ì¬ë£Œë¡œ ë§Œë“¤ì–´ì§„ ë²½ë©´ì˜ ìŒí–¥íˆ¬ê³¼ì†ì‹¤ $L$(ë°ì‹œë²¨)ì€ ë²½ì˜ ë‹¨ìœ„ë©´ì ë‹¹ ì§ˆëŸ‰ $m\\,(\\mathrm{kg/m^2})$ê³¼ ìŒí–¥ì˜ ì£¼íŒŒìˆ˜ $f$(í—¤ë¥´ì¸ )ì— ëŒ€í•˜ì—¬\n\\[\n  L = 20\\log mf - 48\n\\]\nì´ë¼ í•œë‹¤. ì£¼íŒŒìˆ˜ê°€ ì¼ì •í•  ë•Œ, ë²½ì˜ ë‹¨ìœ„ë©´ì ë‹¹ ì§ˆëŸ‰ì´ 5ë°°ê°€ ë˜ë©´ ìŒí–¥íˆ¬ê³¼ì†ì‹¤ì€ $a$(ë°ì‹œë²¨)ë§Œí¼ ì¦ê°€í•œë‹¤. $a$ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.\\\n(ë‹¨, $\\log 2 = 0.3$ìœ¼ë¡œ ê³„ì‚°í•œë‹¤.)",
    choices: null, answer: "14",
    hint: "ì§ˆëŸ‰ì´ $m$ì—ì„œ $5m$ìœ¼ë¡œ ë°”ë€” ë•Œ $L$ì˜ ë³€í™”ëŸ‰ $= 20\\log(5mf) - 20\\log(mf) = 20\\log 5$.",
    solution_latex: "$$\\Delta L = 20\\log(5mf) - 20\\log(mf) = 20\\log 5$$\n$$= 20(1-\\log 2) = 20(1-0.3) = 20 \\times 0.7 = \\mathbf{14}$$"
  }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let state = {
  mode: 'student',         // 'student' | 'teacher'
  currentView: 'dashboard',
  currentFilter: { theme: null, level: 'all' },
  searchQuery: '',
  currentProblemId: null,
  currentListIds: [],       // filtered list for navigation
  progress: {},             // { id: { solved: bool, correct: bool, attempts: int } }
  selectedChoice: null,
  answered: false,
  // Mock teacher data
  students: [
    { name: 'ê¹€ë¯¼ì¤€', solved: 28, emoji: 'ê¹€' },
    { name: 'ì´ì„œì—°', solved: 22, emoji: 'ì´' },
    { name: 'ë°•ì§€í˜¸', solved: 15, emoji: 'ë°•' },
    { name: 'ìµœìœ ì§„', solved: 31, emoji: 'ìµœ' },
    { name: 'ì •ë„í˜„', solved: 9, emoji: 'ì •' },
    { name: 'í•œë‚˜ë˜', solved: 37, emoji: 'í•œ' },
  ]
};

// Load progress from localStorage
function loadProgress() {
  try {
    const saved = localStorage.getItem('step-algebra-progress');
    if (saved) state.progress = JSON.parse(saved);
  } catch(e) {}
}
function saveProgress() {
  try {
    localStorage.setItem('step-algebra-progress', JSON.stringify(state.progress));
  } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showView(viewId) {
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.getElementById('view-' + viewId).classList.add('active');
  state.currentView = viewId;
  updateNavActive();
  updateTopbar(viewId);
}

function updateNavActive() {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const navMap = {
    'dashboard': 'nav-dashboard',
    'problems': 'nav-problems'
  };
  if (navMap[state.currentView]) {
    document.getElementById(navMap[state.currentView])?.classList.add('active');
  }
}

function updateTopbar(viewId) {
  const titles = {
    'dashboard': 'ëŒ€ì‹œë³´ë“œ',
    'problems': 'ë¬¸ì œ ëª©ë¡',
    'solve': 'ë¬¸ì œ í’€ê¸°'
  };
  document.getElementById('topbar-title').textContent = titles[viewId] || '';
  const filtersEl = document.getElementById('topbar-filters');
  filtersEl.style.display = viewId === 'problems' ? 'flex' : 'none';
}

function filterAndShow(theme) {
  state.currentFilter.theme = theme;
  state.searchQuery = '';
  document.getElementById('search-input').value = '';
  showView('problems');
  renderProblemList();
  // Update sidebar active
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const navEl = document.getElementById('nav-' + theme);
  if (navEl) navEl.classList.add('active');
}

function backToList() {
  showView('problems');
  renderProblemList();
}

function setMode(mode) {
  state.mode = mode;
  document.querySelectorAll('.mode-btn').forEach((b, i) => {
    b.classList.toggle('active', (i === 0 && mode === 'student') || (i === 1 && mode === 'teacher'));
  });
  renderDashboard();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FILTER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setLevelFilter(level) {
  state.currentFilter.level = level;
  document.querySelectorAll('.filter-pill').forEach(p => p.classList.remove('active'));
  event.target.classList.add('active');
  renderProblemList();
}

function onSearch() {
  state.searchQuery = document.getElementById('search-input').value.toLowerCase();
  if (state.currentView !== 'problems') {
    showView('problems');
    state.currentFilter.theme = null;
  }
  renderProblemList();
}

function getFilteredProblems() {
  let list = [...PROBLEMS];
  if (state.currentFilter.theme) {
    list = list.filter(p => p.theme === state.currentFilter.theme);
  }
  if (state.currentFilter.level !== 'all') {
    list = list.filter(p => p.level === state.currentFilter.level);
  }
  if (state.searchQuery) {
    list = list.filter(p =>
      p.id.toLowerCase().includes(state.searchQuery) ||
      p.topic.toLowerCase().includes(state.searchQuery) ||
      p.theme_name.toLowerCase().includes(state.searchQuery)
    );
  }
  return list;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER: PROBLEM LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderProblemList() {
  const filtered = getFilteredProblems();
  state.currentListIds = filtered.map(p => p.id);
  const container = document.getElementById('problem-list');

  if (filtered.length === 0) {
    container.innerHTML = `<div class="empty-state"><div class="empty-icon">ğŸ”</div><div class="empty-text">í•´ë‹¹í•˜ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</div></div>`;
    return;
  }

  container.innerHTML = filtered.map(p => {
    const prog = state.progress[p.id] || {};
    const statusClass = prog.solved ? 'solved' : (prog.attempts > 0 ? 'attempted' : '');
    const levelClass = p.level === 'STEP UP' ? 'STEPUP' : p.level;
    const shortQ = p.question_latex.replace(/\$[^$]+\$/g, '(ì‹)').replace(/\\\[[\s\S]*?\\\]/g, '(ìˆ˜ì‹)').substring(0, 50);
    return `
      <div class="problem-card ${statusClass}" onclick="openProblem('${p.id}')">
        <span class="prob-id">${p.id}</span>
        <span class="prob-question">${shortQ}...</span>
        <span class="level-badge ${levelClass}">${p.level}</span>
        <span class="type-badge">${p.type === 'ê°ê´€ì‹' ? 'ê°ê´€ì‹' : 'ì£¼ê´€ì‹'}</span>
      </div>`;
  }).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER: DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard() {
  const solvedCount = Object.values(state.progress).filter(p => p.solved).length;
  const attemptedProbs = Object.values(state.progress).filter(p => p.attempts > 0);
  const correctCount = attemptedProbs.filter(p => p.correct).length;
  const accuracy = attemptedProbs.length > 0 ? Math.round(correctCount / attemptedProbs.length * 100) + '%' : 'â€”';

  document.getElementById('stat-solved').textContent = solvedCount;
  document.getElementById('stat-accuracy').textContent = accuracy;

  const studentCards = document.getElementById('student-theme-cards');
  const teacherDash = document.getElementById('teacher-dash');

  if (state.mode === 'student') {
    studentCards.style.display = 'grid';
    teacherDash.style.display = 'none';
    document.getElementById('sidebar-progress-wrap').style.display = '';

    // Theme cards
    const themes = [
      { id: 'T1', name: 'ê±°ë“­ì œê³±ê·¼', total: 4 },
      { id: 'T2', name: 'ì§€ìˆ˜ë²•ì¹™', total: 8 },
      { id: 'T3', name: 'ë¡œê·¸ì˜ ì„±ì§ˆ', total: 9 },
      { id: 'T4', name: 'ìƒìš©ë¡œê·¸', total: 3 },
      { id: 'STEPUP', name: 'STEP UP', total: 13 },
    ];
    studentCards.innerHTML = themes.map(th => {
      const thProbs = PROBLEMS.filter(p => p.theme === th.id);
      const dots = thProbs.map(p => {
        const pg = state.progress[p.id] || {};
        const cls = pg.solved ? 'solved' : (pg.attempts > 0 ? 'attempted' : '');
        return `<div class="theme-mini-dot ${cls}"></div>`;
      }).join('');
      const solved = thProbs.filter(p => (state.progress[p.id] || {}).solved).length;
      return `
        <div class="theme-card" onclick="filterAndShow('${th.id}')">
          <div class="theme-card-label">${th.id}</div>
          <div class="theme-card-title">${th.name}</div>
          <div class="theme-mini-bar">${dots}</div>
          <div class="theme-count">${solved} / ${th.total} ì™„ë£Œ</div>
        </div>`;
    }).join('');
  } else {
    // Teacher
    studentCards.style.display = 'none';
    teacherDash.style.display = 'block';
    document.getElementById('sidebar-progress-wrap').style.display = 'none';
    renderTeacherDash(); // async â€” ë‚´ë¶€ì—ì„œ Supabase í˜¸ì¶œ
  }

  updateProgressUI();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TEACHER DASHBOARD â€” ì‹¤ì œ ë°ì´í„°
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ì„ ìƒë‹˜ ëŒ€ì‹œë³´ë“œ ì§„ì… ì‹œ í˜¸ì¶œ
async function renderTeacherDash() {
  // ë¡œë”© í‘œì‹œ
  document.getElementById('student-list-panel').innerHTML =
    `<div style="color:var(--txt-3);font-size:13px;padding:12px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;
  document.getElementById('error-table-body').innerHTML =
    `<tr><td colspan="3" style="color:var(--txt-3);font-size:13px;padding:12px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>`;
  document.getElementById('teacher-theme-stats').innerHTML =
    `<div style="color:var(--txt-3);font-size:13px;">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>`;

  try {
    // â”€â”€ 1. ëª¨ë“  í•™ìƒ ëª©ë¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const { data: students, error: e1 } = await db
      .from('users')
      .select('id, name, email, role')
      .eq('role', 'student')
      .order('name');

    if (e1) throw e1;

    // â”€â”€ 2. ëª¨ë“  ì œì¶œ ê¸°ë¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const { data: submissions, error: e2 } = await db
      .from('submissions')
      .select('user_id, problem_id, is_correct, submitted_at');

    if (e2) throw e2;

    // â”€â”€ 3. ë°ì´í„° ê³„ì‚° â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const totalProblems = PROBLEMS.length || 37;

    // í•™ìƒë³„ ì§‘ê³„
    const studentStats = (students || []).map(s => {
      const mySubs = submissions.filter(r => r.user_id === s.id);
      // ë¬¸ì œë³„ë¡œ í•œ ë²ˆì´ë¼ë„ ë§ì€ ê²ƒ = solved
      const solvedSet = new Set(
        mySubs.filter(r => r.is_correct).map(r => r.problem_id)
      );
      const attemptedSet = new Set(mySubs.map(r => r.problem_id));
      const lastActivity = mySubs.length > 0
        ? mySubs.sort((a,b) => b.submitted_at > a.submitted_at ? 1 : -1)[0].submitted_at
        : null;
      return {
        ...s,
        solved:    solvedSet.size,
        attempted: attemptedSet.size,
        total:     mySubs.length,
        lastAt:    lastActivity,
      };
    });

    // ë¬¸ì œë³„ ì˜¤ë‹µë¥ 
    const probStats = {};
    (submissions || []).forEach(r => {
      if (!probStats[r.problem_id])
        probStats[r.problem_id] = { total: 0, wrong: 0 };
      probStats[r.problem_id].total += 1;
      if (!r.is_correct) probStats[r.problem_id].wrong += 1;
    });

    // ì˜¤ë‹µë¥  ë†’ì€ ìˆœ TOP 5
    const topErrors = Object.entries(probStats)
      .filter(([, v]) => v.total >= 1)
      .map(([pid, v]) => ({
        id:    pid,
        topic: (PROBLEMS.find(p => p.id === pid)?.topic || pid).replace(/_/g, ' '),
        rate:  Math.round(v.wrong / v.total * 100),
        total: v.total,
      }))
      .sort((a, b) => b.rate - a.rate)
      .slice(0, 5);

    // ë‹¨ì›ë³„ ì •ë‹µë¥ 
    const themes = [
      { id: 'T1',     name: 'T1 ê±°ë“­ì œê³±ê·¼' },
      { id: 'T2',     name: 'T2 ì§€ìˆ˜ë²•ì¹™'   },
      { id: 'T3',     name: 'T3 ë¡œê·¸ ì„±ì§ˆ'  },
      { id: 'T4',     name: 'T4 ìƒìš©ë¡œê·¸'   },
      { id: 'STEPUP', name: 'STEP UP'        },
    ];
    const themeStats = themes.map(th => {
      const thProbIds = PROBLEMS.filter(p => p.theme === th.id).map(p => p.id);
      const thSubs = (submissions || []).filter(r => thProbIds.includes(r.problem_id));
      if (thSubs.length === 0) return { ...th, rate: null };
      const correct = thSubs.filter(r => r.is_correct).length;
      return { ...th, rate: Math.round(correct / thSubs.length * 100) };
    });

    // â”€â”€ 4. ë Œë”ë§ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    _renderStudentList(studentStats, totalProblems);
    _renderErrorTable(topErrors);
    _renderThemeStats(themeStats);
    _renderSummaryCards(studentStats, submissions || []);

  } catch (err) {
    console.error('ì„ ìƒë‹˜ ëŒ€ì‹œë³´ë“œ ë¡œë“œ ì‹¤íŒ¨:', err.message);
    document.getElementById('student-list-panel').innerHTML =
      `<div style="color:var(--red);font-size:13px;padding:12px;">ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨: ${err.message}</div>`;
  }
}

function _renderStudentList(students, total) {
  const el = document.getElementById('student-list-panel');
  if (students.length === 0) {
    el.innerHTML = `<div style="color:var(--txt-3);font-size:13px;padding:12px;">ì•„ì§ ê°€ì…í•œ í•™ìƒì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }
  el.innerHTML = students.map(s => {
    const pct = Math.round(s.solved / total * 100);
    const initial = (s.name || s.email || '?').charAt(0).toUpperCase();
    const lastStr = s.lastAt
      ? new Date(s.lastAt).toLocaleDateString('ko-KR', { month:'short', day:'numeric' })
      : 'í™œë™ ì—†ìŒ';
    return `
      <div class="student-row" style="cursor:default;">
        <div class="student-avatar">${initial}</div>
        <div class="student-info" style="flex:1;overflow:hidden;">
          <div class="student-name">${s.name || s.email}</div>
          <div style="font-size:10px;color:var(--txt-3);font-family:var(--font-mono);">ë§ˆì§€ë§‰ í™œë™: ${lastStr}</div>
        </div>
        <div style="text-align:right;min-width:60px;">
          <div class="student-progress">${s.solved}/${total}</div>
          <div style="font-size:10px;color:var(--txt-3);">${pct}%</div>
        </div>
        <div class="mini-prog" style="width:70px;">
          <div class="mini-prog-fill" style="width:${pct}%;background:${pct>=70?'var(--green)':pct>=40?'var(--gold)':'var(--red)'}"></div>
        </div>
      </div>`;
  }).join('');
}

function _renderErrorTable(errors) {
  const el = document.getElementById('error-table-body');
  if (errors.length === 0) {
    el.innerHTML = `<tr><td colspan="3" style="color:var(--txt-3);font-size:13px;padding:12px;text-align:center;">ì œì¶œ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>`;
    return;
  }
  el.innerHTML = errors.map(e => {
    const col = e.rate >= 70 ? 'var(--red)' : e.rate >= 50 ? 'var(--gold)' : 'var(--green)';
    const cls = e.rate >= 70 ? 'high' : e.rate >= 50 ? 'mid' : 'low';
    return `<tr>
      <td><span class="prob-id" style="font-size:12px;">${e.id}</span></td>
      <td style="font-size:12px;">${e.topic}<span style="color:var(--txt-3);margin-left:4px;">(${e.total}íšŒ)</span></td>
      <td>
        <span class="error-bar-sm">
          <div class="error-bar-fill" style="width:${e.rate}%;background:${col}"></div>
        </span>
        <span class="error-rate ${cls}">${e.rate}%</span>
      </td>
    </tr>`;
  }).join('');
}

function _renderThemeStats(themeStats) {
  document.getElementById('teacher-theme-stats').innerHTML =
    themeStats.map(th => {
      const r   = th.rate;
      const col = r === null ? 'var(--txt-3)' : r >= 70 ? 'var(--green)' : r >= 50 ? 'var(--gold)' : 'var(--red)';
      const pct = r === null ? 0 : r;
      const label = r === null ? 'ë°ì´í„° ì—†ìŒ' : `${r}%`;
      return `
        <div style="display:flex;align-items:center;gap:12px;margin-bottom:12px;">
          <span style="font-family:var(--font-mono);font-size:11px;color:var(--txt-2);width:130px;flex-shrink:0;">${th.name}</span>
          <div class="progress-bar-wrap" style="flex:1;">
            <div class="progress-bar-fill" style="width:${pct}%;background:${col};transition:width 0.6s ease;"></div>
          </div>
          <span style="font-family:var(--font-mono);font-size:12px;color:${col};width:60px;text-align:right;">${label}</span>
        </div>`;
    }).join('');
}

function _renderSummaryCards(students, submissions) {
  // ìƒë‹¨ ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸ (ìˆìœ¼ë©´)
  const totalStudents = students.length;
  const activeToday = students.filter(s => {
    if (!s.lastAt) return false;
    const d = new Date(s.lastAt);
    const today = new Date();
    return d.toDateString() === today.toDateString();
  }).length;

  const elStudents = document.getElementById('stat-total-students');
  const elActive   = document.getElementById('stat-active-today');
  const elSubs     = document.getElementById('stat-total-subs');
  if (elStudents) elStudents.textContent = totalStudents;
  if (elActive)   elActive.textContent   = activeToday;
  if (elSubs)     elSubs.textContent     = submissions.length;
}

function updateProgressUI() {
  const solved = Object.values(state.progress).filter(p => p.solved).length;
  const pct = Math.round(solved / 37 * 100);
  document.getElementById('prog-solved').textContent = `${solved} / 37`;
  document.getElementById('prog-bar').style.width = pct + '%';
  document.getElementById('stat-solved').textContent = solved;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER: PROBLEM SOLVE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openProblem(id) {
  const prob = PROBLEMS.find(p => p.id === id);
  if (!prob) return;
  state.currentProblemId = id;
  state.answered = false;
  state.selectedChoice = null;

  // If navigating from a theme sidebar, make sure list is set
  if (state.currentListIds.length === 0) state.currentListIds = PROBLEMS.map(p => p.id);

  showView('solve');
  renderProblem(prob);
  // Scroll to top
  window.scrollTo(0, 0);
  // Re-typeset MathJax
  setTimeout(() => { if (window.MathJax) MathJax.typesetPromise(); }, 100);
}

function renderProblem(prob) {
  document.getElementById('solve-id').textContent = prob.id;
  document.getElementById('solve-topic').textContent = (prob.topic || '').replace(/_/g, ' ');

  // Meta bar
  const levelClass = prob.level === 'STEP UP' ? 'STEPUP' : (prob.level || '');
  document.getElementById('prob-meta-bar').innerHTML = `
    <span class="level-badge ${levelClass}">${prob.level || ''}</span>
    <span class="type-badge" style="margin-left:4px;">${prob.type || ''} Â· ${prob.subtype || ''}</span>
    <span style="margin-left:8px;font-size:12px;color:var(--txt-3);font-family:var(--font-mono);">${prob.theme_name || ''}</span>
  `;

  // Question body â€” \textbf, \text ë³€í™˜
  const qLatex = (prob.question_latex || '')
    .replace(/\\textbf\{([^}]+)\}/g, '<strong>$1</strong>')
    .replace(/\\text\{([^}]+)\}/g, '$1');
  document.getElementById('solve-body').innerHTML = qLatex;

  // choices ì²˜ë¦¬ â€” Supabase JSONBëŠ” ì´ë¯¸ ë°°ì—´ì´ì§€ë§Œ
  // í˜¹ì‹œ ë¬¸ìì—´ë¡œ ì˜¤ëŠ” ê²½ìš°ë„ ì•ˆì „í•˜ê²Œ íŒŒì‹±
  let choices = prob.choices;
  if (typeof choices === 'string') {
    try { choices = JSON.parse(choices); } catch(e) { choices = null; }
  }

  // Answer area
  const answerArea = document.getElementById('answer-area');
  if (prob.type === 'ê°ê´€ì‹' && Array.isArray(choices) && choices.length > 0) {
    answerArea.innerHTML = `<div class="choices-grid" id="choices-grid">
      ${choices.map((c, i) => `
        <div class="choice-item" id="choice-${i}" onclick="selectChoice(${i})">
          <div class="choice-num">${i+1}</div>
          <div>$${c}$</div>
        </div>`).join('')}
    </div>`;
  } else {
    answerArea.innerHTML = `
      <div class="answer-input-wrap">
        <input class="answer-input" type="text" id="answer-input"
          placeholder="ë‹µì„ ì…ë ¥í•˜ì„¸ìš”..."
          onkeydown="if(event.key==='Enter')submitAnswer()">
      </div>`;
  }

  // Reset result banners
  document.getElementById('result-correct').classList.remove('show');
  document.getElementById('result-wrong').classList.remove('show');

  // Reset accordions
  closeAccordion('hint-body', 'hint-chev');
  closeAccordion('sol-body', 'sol-chev');

  // Hint â€” null ì•ˆì „ ì²˜ë¦¬
  document.getElementById('hint-content').innerHTML =
    (prob.hint || 'íŒíŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');

  // Solution â€” null ì•ˆì „ ì²˜ë¦¬
  document.getElementById('sol-content').innerHTML =
    (prob.solution_latex || 'í’€ì´ê°€ ì—†ìŠµë‹ˆë‹¤.')
      .replace(/\n/g, '<br>')
      .replace(/\*\*([^*]+)\*\*/g, '<strong>$1</strong>');

  // Navigation buttons
  const idx = state.currentListIds.indexOf(prob.id);
  document.getElementById('btn-prev').disabled = idx <= 0;
  document.getElementById('btn-next').disabled =
    idx >= state.currentListIds.length - 1;

  // Submit button ì´ˆê¸°í™”
  document.getElementById('btn-submit').disabled = false;
  document.getElementById('btn-submit').textContent = 'ì œì¶œ';
}

function selectChoice(idx) {
  if (state.answered) return;
  state.selectedChoice = idx;
  document.querySelectorAll('.choice-item').forEach((el, i) => {
    el.classList.toggle('selected', i === idx);
  });
}

function submitAnswer() {
  const prob = PROBLEMS.find(p => p.id === state.currentProblemId);
  if (!prob || state.answered) return;

  let isCorrect = false;

  if (prob.type === 'ê°ê´€ì‹') {
    if (state.selectedChoice === null) {
      showToast('ì„ íƒì§€ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.', 'info');
      return;
    }
    const correctIdx = parseInt(prob.answer) - 1;
    isCorrect = state.selectedChoice === correctIdx;

    document.querySelectorAll('.choice-item').forEach((el, i) => {
      el.classList.remove('selected');
      if (i === correctIdx) el.classList.add('correct');
      else if (i === state.selectedChoice && !isCorrect) el.classList.add('wrong');
    });
  } else {
    const input = document.getElementById('answer-input');
    if (!input || !input.value.trim()) {
      showToast('ë‹µì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'info');
      return;
    }
    // ê³µë°±Â·ë¶„ìˆ˜ í‘œê¸° ì •ê·œí™” í›„ ë¹„êµ
    const normalize = s => s.trim().replace(/\s/g, '').replace(/âˆ’/g, '-');
    const userAns    = normalize(input.value);
    const correctAns = normalize((prob.answer || '').toString());
    isCorrect = userAns === correctAns;
    input.classList.add(isCorrect ? 'correct' : 'wrong');
    input.disabled = true;
  }

  state.answered = true;
  document.getElementById('btn-submit').disabled = true;
  document.getElementById('btn-submit').textContent = 'ì œì¶œë¨';

  if (isCorrect) {
    document.getElementById('result-correct').classList.add('show');
    showToast('ğŸ‰ ì •ë‹µì…ë‹ˆë‹¤!', 'success');
  } else {
    document.getElementById('result-wrong').classList.add('show');
    document.getElementById('correct-answer-reveal').innerHTML =
      `ì •ë‹µ: <span class="answer-reveal">${prob.answer}</span>`;
    setTimeout(() => {
      openAccordion('sol-body', 'sol-chev');
      if (window.MathJax) MathJax.typesetPromise();
    }, 400);
    showToast('í‹€ë ¸ìŠµë‹ˆë‹¤. í’€ì´ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.', 'error');
  }

  // ì§„ë„ ì—…ë°ì´íŠ¸
  if (!state.progress[prob.id])
    state.progress[prob.id] = { solved: false, correct: false, attempts: 0 };
  state.progress[prob.id].attempts += 1;
  if (isCorrect) {
    state.progress[prob.id].solved  = true;
    state.progress[prob.id].correct = true;
  }

  // Supabaseì— ì œì¶œ ê¸°ë¡ ì €ì¥ (ë¡œê·¸ì¸ ìƒíƒœì¼ ë•Œ)
  const userAnswer = prob.type === 'ê°ê´€ì‹'
    ? String(state.selectedChoice + 1)
    : (document.getElementById('answer-input')?.value || '');
  saveSubmissionToSupabase(prob.id, userAnswer, isCorrect);

  saveProgress();
  updateProgressUI();
}

function navigateProb(dir) {
  const idx = state.currentListIds.indexOf(state.currentProblemId);
  const nextIdx = idx + dir;
  if (nextIdx >= 0 && nextIdx < state.currentListIds.length) {
    openProblem(state.currentListIds[nextIdx]);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ACCORDION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleAccordion(bodyId, chevId) {
  const body = document.getElementById(bodyId);
  const chev = document.getElementById(chevId);
  body.classList.toggle('open');
  chev.classList.toggle('open');
  setTimeout(() => { if (window.MathJax) MathJax.typesetPromise(); }, 50);
}
function openAccordion(bodyId, chevId) {
  document.getElementById(bodyId).classList.add('open');
  document.getElementById(chevId).classList.add('open');
}
function closeAccordion(bodyId, chevId) {
  document.getElementById(bodyId).classList.remove('open');
  document.getElementById(chevId).classList.remove('open');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let toastTimer;
function showToast(msg, type = 'info') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = `toast ${type} show`;
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => { t.classList.remove('show'); }, 2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUTH â€” ë¡œê·¸ì¸ / íšŒì›ê°€ì… / ë¡œê·¸ì•„ì›ƒ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser = null;   // Supabase auth user
let currentProfile = null; // users í…Œì´ë¸” row
let selectedRole = 'student';

function switchAuthTab(tab) {
  document.querySelectorAll('.auth-tab').forEach((b, i) => {
    b.classList.toggle('active', (i === 0 && tab === 'login') || (i === 1 && tab === 'signup'));
  });
  document.getElementById('auth-login-form').style.display  = tab === 'login'  ? '' : 'none';
  document.getElementById('auth-signup-form').style.display = tab === 'signup' ? '' : 'none';
  // ì—ëŸ¬ ì´ˆê¸°í™”
  document.getElementById('login-error').classList.remove('show');
  document.getElementById('signup-error').classList.remove('show');
}

function selectRole(role) {
  selectedRole = role;
  document.getElementById('role-student').classList.toggle('selected', role === 'student');
  document.getElementById('role-teacher').classList.toggle('selected', role === 'teacher');
}

function showAuthError(formId, msg) {
  const el = document.getElementById(formId + '-error');
  el.textContent = msg;
  el.classList.add('show');
}

// ë¡œê·¸ì¸
async function handleLogin() {
  const email    = document.getElementById('login-email').value.trim();
  const password = document.getElementById('login-password').value;
  if (!email || !password) { showAuthError('login', 'ì´ë©”ì¼ê³¼ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

  const btn = document.getElementById('login-btn');
  btn.disabled = true;
  btn.textContent = 'ë¡œê·¸ì¸ ì¤‘...';

  const { data, error } = await db.auth.signInWithPassword({ email, password });

  btn.disabled = false;
  btn.textContent = 'ë¡œê·¸ì¸';

  if (error) {
    const msg = error.message.includes('Invalid') ? 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.' : error.message;
    showAuthError('login', msg);
    return;
  }
  // onAuthStateChange ê°€ ìë™ìœ¼ë¡œ ì²˜ë¦¬
}

// íšŒì›ê°€ì…
async function handleSignup() {
  const name     = document.getElementById('signup-name').value.trim();
  const email    = document.getElementById('signup-email').value.trim();
  const password = document.getElementById('signup-password').value;

  if (!name)            { showAuthError('signup', 'ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if (!email)           { showAuthError('signup', 'ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
  if (password.length < 6) { showAuthError('signup', 'ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.'); return; }

  const btn = document.getElementById('signup-btn');
  btn.disabled = true;
  btn.textContent = 'ê°€ì… ì¤‘...';

  // 1. Supabase Auth ê³„ì • ìƒì„±
  const { data, error } = await db.auth.signUp({ email, password });

  if (error) {
    btn.disabled = false;
    btn.textContent = 'íšŒì›ê°€ì…';
    const msg = error.message.includes('already') ? 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤.' : error.message;
    showAuthError('signup', msg);
    return;
  }

  // 2. users í…Œì´ë¸”ì— í”„ë¡œí•„ ì €ì¥
  if (data.user) {
    await db.from('users').upsert({
      id:    data.user.id,
      email: email,
      name:  name,
      role:  selectedRole,
    });
  }

  btn.disabled = false;
  btn.textContent = 'íšŒì›ê°€ì…';
  showToast('ğŸ‰ íšŒì›ê°€ì… ì™„ë£Œ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'success');
  switchAuthTab('login');
  document.getElementById('login-email').value = email;
}

// ë¡œê·¸ì•„ì›ƒ
async function handleLogout() {
  await db.auth.signOut();
  currentUser    = null;
  currentProfile = null;
  showAuthOverlay(true);
  showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
}

// ë¡œê·¸ì¸ í›„ UI ì—…ë°ì´íŠ¸
async function onUserLoggedIn(user) {
  currentUser = user;

  // users í…Œì´ë¸”ì—ì„œ í”„ë¡œí•„ ê°€ì ¸ì˜¤ê¸°
  const { data: profile } = await db
    .from('users')
    .select('*')
    .eq('id', user.id)
    .single();

  currentProfile = profile;

  // ì‚¬ì´ë“œë°” ìœ ì € í‘œì‹œ
  const name  = profile?.name  || user.email.split('@')[0];
  const role  = profile?.role  || 'student';
  const initial = name.charAt(0).toUpperCase();

  document.getElementById('user-avatar').textContent   = initial;
  document.getElementById('user-name').textContent     = name;
  document.getElementById('user-role-label').textContent = role === 'teacher' ? 'ì„ ìƒë‹˜' : 'í•™ìƒ';
  document.getElementById('sidebar-user').style.display = '';

  // ì—­í• ì— ë”°ë¼ ëª¨ë“œ ìë™ ì„¤ì •
  if (role === 'teacher') {
    setMode('teacher');
    // ì„ ìƒë‹˜ì€ mode-toggle ìˆ¨ê¹€ (ìë™ teacher ëª¨ë“œ)
    document.getElementById('mode-toggle-wrap').style.display = 'none';
  } else {
    setMode('student');
    document.getElementById('mode-toggle-wrap').style.display = 'none'; // í•™ìƒë„ ìˆ¨ê¹€
  }

  // ë¡œê·¸ì¸ í™”ë©´ ë‹«ê¸°
  showAuthOverlay(false);

  // Supabaseì—ì„œ ì´ í•™ìƒì˜ ì œì¶œ ê¸°ë¡ ë¡œë“œ
  await loadSubmissionsFromSupabase(user.id);
  renderDashboard();
  renderProblemList();
  updateTopbar('dashboard');
  setTimeout(() => { if (window.MathJax) MathJax.typesetPromise(); }, 500);
}

function showAuthOverlay(show) {
  document.getElementById('auth-overlay').style.display = show ? 'flex' : 'none';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUBMISSIONS â€” Supabaseì—ì„œ ì§„ë„ ë¡œë“œ
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function loadSubmissionsFromSupabase(userId) {
  try {
    const { data, error } = await db
      .from('submissions')
      .select('problem_id, is_correct')
      .eq('user_id', userId);

    if (error) throw error;

    // submissions â†’ state.progress ë³€í™˜
    // ë¬¸ì œ idë³„ë¡œ ë§ì€ ì  ìˆìœ¼ë©´ solved:true
    const progressFromDB = {};
    (data || []).forEach(row => {
      if (!progressFromDB[row.problem_id]) {
        progressFromDB[row.problem_id] = { solved: false, correct: false, attempts: 0 };
      }
      progressFromDB[row.problem_id].attempts += 1;
      if (row.is_correct) {
        progressFromDB[row.problem_id].solved  = true;
        progressFromDB[row.problem_id].correct = true;
      }
    });
    state.progress = progressFromDB;
    updateProgressUI();
  } catch(e) {
    console.warn('ì œì¶œ ê¸°ë¡ ë¡œë“œ ì‹¤íŒ¨:', e.message);
  }
}

// ì œì¶œ ê¸°ë¡ Supabaseì— ì €ì¥
async function saveSubmissionToSupabase(problemId, userAnswer, isCorrect) {
  if (!currentUser) return; // ë¹„ë¡œê·¸ì¸ì´ë©´ ê±´ë„ˆëœ€
  try {
    await db.from('submissions').insert({
      user_id:     currentUser.id,
      problem_id:  problemId,
      user_answer: userAnswer,
      is_correct:  isCorrect,
    });
  } catch(e) {
    console.warn('ì œì¶œ ì €ì¥ ì‹¤íŒ¨:', e.message);
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function init() {
  // 1. ë¬¸ì œ ë¨¼ì € ë¡œë“œ (ë¡œê·¸ì¸ ì—¬ë¶€ ë¬´ê´€)
  await loadProblemsFromSupabase();
  if (PROBLEMS.length === 0) {
    PROBLEMS = [...PROBLEMS_FALLBACK];
  }

  // 2. Auth ìƒíƒœ ë³€í™” ê°ì§€
  db.auth.onAuthStateChange(async (event, session) => {
    if (session?.user) {
      await onUserLoggedIn(session.user);
    } else {
      // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ â†’ ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
      showAuthOverlay(true);
    }
  });

  // 3. í˜„ì¬ ì„¸ì…˜ í™•ì¸ (ì´ë¯¸ ë¡œê·¸ì¸ëœ ê²½ìš° ìë™ ì²˜ë¦¬)
  const { data: { session } } = await db.auth.getSession();
  if (!session) {
    // ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ
    showLoadingScreen(false);
    showAuthOverlay(true);
  }
  // ì„¸ì…˜ ìˆìœ¼ë©´ onAuthStateChange ê°€ ìë™ìœ¼ë¡œ onUserLoggedIn í˜¸ì¶œ
}

init();
</script>
</body>
</html>
